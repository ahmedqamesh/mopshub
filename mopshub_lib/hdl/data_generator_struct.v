//
// Module mopshub_lib.data_generator.struct
//
// Created:
//          by - dcs.dcs (chipdev2.physik.uni-wuppertal.de)
//          at - 19:02:21 07/23/21
//
// Generated by Mentor Graphics' HDL Designer(TM) 2019.4 (Build 4)
//

`resetall
`timescale 1ns/10ps
module data_generator #(
   // synopsys template
   parameter DATA_WIDTH   = 76,
   parameter max_cnt_size = 5,
   parameter CAN_ID_WIDTH = 12,
   parameter SDO_RX       = 5'h0B,
   parameter SDO_TX       = 5'h0C,
   parameter n_buses      = 5'b11111
)
( 
   // Port Declarations
   output  wire                      done, 
   input   wire                      rst, 
   output  reg     [DATA_WIDTH-1:0]  bus_payload         = 76'b0100000, 
   input   wire                      clk,                                // write FIFO clk
   output  wire                      buffer_en, 
   input   wire                      loop_en, 
   input   wire                      sign_on_sig, 
   input   wire                      start_read_elink, 
   input   wire                      osc_auto_trim, 
   input   wire                      tx_mopshub, 
   output  wire                      indic_sign_in, 
   output  wire                      reqmsg, 
   output  wire                      respmsg, 
   input   wire                      read_adc, 
   input   wire                      startsm, 
   input   wire                      clk_low, 
   input   wire                      send_mes_can_done, 
   output  wire    [31:0]            ch, 
   input   wire                      rx, 
   input   wire                      elink_test, 
   output  wire                      irq_elink, 
   output  wire                      end_read_elink, 
   output  wire                      start_trim_sig, 
   output  wire                      read_adc_start, 
   output  wire                      read_adc_end, 
   output  wire    [75:0]            bus_data, 
   input   wire    [5:0]             sel_bus, 
   input   wire    [4:0]             sel_ch
);


// Internal Declarations


// Local declarations

// Internal signal declarations
reg   [7:0]              bus_id            = 7'b0;
wire  [CAN_ID_WIDTH-1:0] sdoid;                              // this is the actual ID of the CANOpen message for SDO objects
wire                     counter_en;
wire  [max_cnt_size-1:0] bus_cnt;
wire  [2:0]              state_o;
wire                     ext_rst;
reg                      out_request_trig;
wire                     start;                             // To start Driver /generator
wire                     read;                              // Prepare SDO read request
wire                     write;                             // Prepare SDO write request
wire  [23:0]             indexsubindex;                      // from state machine index and subindex to write and read. Index bytes are sent LSB first 
wire  [31:0]             taildata;                          // Data which must be written to the chip 
wire  [63:0]             data;                              // Complete 8 bytes of data to be sent in a custom message
wire                     readadc;                           // indicates to read an ADC channel 
wire  [10:0]             customcanid;                       // ID to be sent in a custom message
wire                     custommsg;                         // To start a custom message
wire                     txgen;
wire  [3:0]              dlc               = 4'h8;          // "1" = wait for oscillator trimming before sign-in message 
wire  [10:0]             id                = 11'h601;       // here define the node id for the chip to communicate with 
reg   [6:0]              can_nodeid        = 7'h1;           // Hardwired CANopen Node-ID for each DCS controller chip
wire                     txmops;
wire                     ready_osc;
wire                     tx;
wire                     txdec;
reg   [56-1:0]           payload           = 56'b0000000;
wire  [4:0]              ch_cnt;


// Instances 
CANbus_decoder CANbus_decoder0( 
   .clk          (clk), 
   .rst          (rst), 
   .rx           (rx), 
   .data_rec_out (bus_data), 
   .tx           (txdec)
); 

bit_counter bit_counter2( 
   .ext_rst    (ext_rst), 
   .rst        (rst), 
   .data_out   (bus_cnt), 
   .clk        (clk), 
   .cnt_enable (counter_en)
); 

canframegen canframegen0( 
   .clk           (clk), 
   .clk_low       (clk_low), 
   .rst_n         (rst), 
   .start         (start), 
   .read          (read), 
   .write         (write), 
   .random1000    (), 
   .indexsubindex (indexsubindex), 
   .rstchip       (), 
   .readadc       (readadc), 
   .allch         (), 
   .ch            (ch), 
   .custommsg     (custommsg), 
   .dlc           (dlc), 
   .data          (data), 
   .id            (id), 
   .txgen         (txgen), 
   .doneranwire   (), 
   .finranmes     (), 
   .sendran       (), 
   .nextran       (), 
   .taildata      (taildata), 
   .customcanid   (customcanid)
); 

data_generator_SM data_generator_SM0( 
   .clk               (clk), 
   .rst               (rst), 
   .done              (done), 
   .send_mes_can_done (send_mes_can_done), 
   .startsm           (startsm), 
   .irq_elink         (irq_elink), 
   .txdec             (tx_mopshub), 
   .counter_en        (counter_en), 
   .ch                (ch), 
   .buffer_en         (buffer_en), 
   .state_o           (state_o), 
   .loop_en           (loop_en), 
   .customcanid       (customcanid), 
   .end_read_elink    (end_read_elink), 
   .indexsubindex     (indexsubindex), 
   .custommsg         (custommsg), 
   .cnt_done          (out_request_trig), 
   .readadc           (readadc), 
   .data              (data), 
   .read              (read), 
   .sign_on_sig       (sign_on_sig), 
   .start_read_elink  (start_read_elink), 
   .reqmsg            (reqmsg), 
   .respmsg           (respmsg), 
   .taildata          (taildata), 
   .start             (start), 
   .osc_auto_trim     (osc_auto_trim), 
   .write             (write), 
   .trimming_done     (ready_osc), 
   .indic_sign_in     (indic_sign_in), 
   .read_adc          (read_adc), 
   .read_adc_end      (read_adc_end), 
   .read_adc_start    (read_adc_start), 
   .start_trim_sig    (start_trim_sig), 
   .elink_test        (elink_test), 
   .ch_cnt            (ch_cnt), 
   .bus_cnt           (bus_cnt), 
   .sel_ch            (sel_ch), 
   .sel_bus           (sel_bus)
); 

mops_top_level mops_top_level0( 
   .can_nodeid    (can_nodeid), 
   .can_rx        (rx), 
   .clk           (clk), 
   .clk_osc       (clk), 
   .osc_auto_trim (osc_auto_trim), 
   .rst_n         (rst), 
   .can_tx        (txmops), 
   .ready_osc     (ready_osc)
); 

// HDL Embedded Text Block 1 data_loader
// data_loader 1
assign sdoid = {SDO_TX,can_nodeid}; //600+nodeid 
always @(posedge clk)
begin
  if(!rst)
  begin
    bus_id  <= 8'h20;
    bus_payload <= {sdoid,56'h0, bus_id};
  end
  else
  case (bus_cnt)
    5'h0 : begin 
      bus_id  <= 8'h0; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h1 : begin
      bus_id  <= 8'h1; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h2 : begin 
      bus_id  <= 8'h2; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h3 : begin 
      bus_id  <= 8'h3; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h4 : begin 
      bus_id  <= 8'h4;
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h5 : begin
      bus_id  <= 8'h5; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h6 : begin 
      bus_id  <= 8'h6; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h7 : begin 
      bus_id  <= 8'h7; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h8 : begin 
      bus_id  <= 8'h8; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h9 : begin 
      bus_id  <= 8'h9;
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'hA : begin 
      bus_id  <= 8'hA; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'hB : begin 
      bus_id  <= 8'hB; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'hC : begin 
      bus_id  <= 8'hC; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'hD : begin 
      bus_id  <= 8'hD; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'hE : begin 
      bus_id  <= 8'hE;
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'hF : begin 
      bus_id  <= 8'hF; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h10 : begin 
      bus_id  <= 8'h10; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h11 : begin 
      bus_id  <= 8'h11; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h12 : begin 
      bus_id  <= 8'h12; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h13 : begin 
      bus_id  <= 8'h13;
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h14 : begin 
      bus_id  <= 8'h14; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h15 : begin 
      bus_id  <= 8'h15; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h16 : begin 
      bus_id  <= 8'h16; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h17 : begin 
      bus_id  <= 8'h17;
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h18 : begin 
      bus_id  <= 8'h18; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h19 : begin 
      bus_id  <= 8'h19; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h1A : begin 
      bus_id  <= 8'h1A; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h1B : begin 
      bus_id  <= 8'h1B; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h1C : begin 
      bus_id  <= 8'h1C;
      bus_payload  <= {sdoid,payload,bus_id};
      
    end 
    5'h1D : begin 
      bus_id  <= 8'h1D; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h1E : begin 
      bus_id  <= 8'h1E; 
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    5'h1F : begin 
      bus_id  <= 8'h1F;
      bus_payload  <= {sdoid,payload,bus_id};
      
    end
    default: begin 
      bus_id  <= 8'h20;
      bus_payload  <= {sdoid,56'h0, bus_id}; 
    end    
  endcase
end                                            















































































// HDL Embedded Text Block 2 trigger_signal
always @(negedge clk)
  begin
    if (!rst)
    begin
    out_request_trig <= 0;
    end
    else 
    begin
      case(bus_cnt)
       n_buses:begin
          out_request_trig <= 1;
        end
      default:begin
          out_request_trig <= 0;
        end
      endcase
  end
end











// HDL Embedded Text Block 3 rx_assign
assign rx =  ~(rst ^ (tx_mopshub & txgen & txmops));
assign tx = tx_mopshub | txmops;
















// HDL Embedded Text Block 4 channel_definition
always @(posedge clk)
begin
  if(!rst)
  payload <= {16'h0, 16'h0, 16'h0, 8'h0};
  else
  case (ch_cnt)
    5'h0 : 
    begin 
      payload  <= {16'h4010, 16'h2301, 16'h0,8'h0};
      
    end
    5'h1 : 
    begin
      payload  <= {16'h4010, 16'h2302, 16'h0,8'h0};
      
    end
    5'h2 : 
    begin 
      payload  <= {16'h4010, 16'h2303, 16'h0,8'h0};
      
    end
    5'h3 : 
    begin  
      payload  <= {16'h4000, 16'h2401, 16'h0,8'h0};
      
    end
    5'h4 : 
    begin 
      payload  <= {16'h4000, 16'h2402, 16'h0, 8'h0};
    end
    5'h5 : 
    begin 
      payload  <= {16'h4000, 16'h2403, 16'h0, 8'h0};     
    end
    5'h6 : 
    begin 
      payload  <= {16'h4000, 16'h2404, 16'h0, 8'h0};  
    end
    5'h7 : 
    begin 
      payload  <= {16'h4000, 16'h2405, 16'h0, 8'h0};
      
    end
    5'h8 : 
    begin 
      payload  <= {16'h4000, 16'h2406, 16'h0, 8'h0};
      
    end
    5'h9 : 
    begin 
      payload  <= {16'h4000, 16'h2407, 16'h0, 8'h0};
      
    end
    5'hA : 
    begin  
      payload  <= {16'h4000, 16'h2408, 16'h0, 8'h0};
      
    end
    5'hB : 
    begin 
      payload  <= {16'h4000, 16'h2409, 16'h0, 8'h0};
      
    end
    5'hC : 
    begin 
      payload  <= {16'h4000, 16'h240A, 16'h0, 8'h0};
      
    end
    5'hD : 
    begin 
      payload  <= {16'h4000, 16'h240B, 16'h0, 8'h0};
      
    end
    5'hE : 
    begin 
      payload  <= {16'h4000, 16'h240C, 16'h0, 8'h0};
      
    end
    5'hF : 
    begin 
      payload  <= {16'h4000, 16'h240D, 16'h0, 8'h0};
      
    end
    5'h10 : 
    begin 
      payload  <= {16'h4000, 16'h240E, 16'h0, 8'h0};
      
    end
    5'h11 : begin 
      payload  <= {16'h4000, 16'h240F, 16'h0, 8'h0};
      
    end
    5'h12 : 
    begin
      payload  <= {16'h4000, 16'h24010, 16'h0, 8'h0};
      
    end
    5'h13 : 
    begin
      payload  <= {16'h4000, 16'h24011, 16'h0, 8'h0};
      
    end
    5'h14 : 
    begin 
      payload  <= {16'h4000, 16'h24012, 16'h0, 8'h0};
      
    end
    5'h15 : 
    begin 
      payload  <= {16'h4000, 16'h24013, 16'h0, 8'h0};
      
    end
    5'h16 : 
    begin
      payload  <= {16'h4000, 16'h24014, 16'h0, 8'h0};
      
    end
    5'h17 : 
    begin
      payload  <= {16'h4000, 16'h24015, 16'h0, 8'h0};
      
    end
    5'h18 : 
    begin  
      payload  <= {16'h4000, 16'h24016, 16'h0, 8'h0};
      
    end
    5'h19 : 
    begin 
      payload  <= {16'h4000, 16'h24017, 16'h0, 8'h0};
      
    end
    5'h1A : 
    begin
      payload  <= {16'h4000, 16'h24018, 16'h0, 8'h0};
      
    end
    5'h1B : 
    begin 
      payload  <= {16'h4000, 16'h24019, 16'h0, 8'h0};
      
    end
    5'h1C : 
    begin
      payload  <= {16'h4000, 16'h2401A, 16'h0, 8'h0};
      
    end 
    5'h1D : 
    begin
      payload  <= {16'h4000, 16'h2401B, 16'h0, 8'h0};
      
    end
    5'h1E : 
    begin 
      payload  <= {16'h4000, 16'h2401C, 16'h0, 8'h0};
      
    end
    5'h1F : 
    begin 
      payload  <= {16'h4000, 16'h2401D, 16'h0, 8'h0};
      
    end
    5'h20 : begin 
      payload  <= {16'h4000, 16'h2401E, 16'h0, 8'h0};
      
    end
    5'h21 : 
    begin 
      payload  <= {16'h4000, 16'h2401F, 16'h0, 8'h0};
      
    end
    5'h22 : 
    begin 
      payload  <= {16'h4000, 16'h24020, 16'h0, 8'h0};
      
    end
    5'h23 : 
    begin 
      payload  <= {16'h4000, 16'h24021, 16'h0, 8'h0};
      
    end
    5'h24 : 
    begin 
      payload  <= {16'h4000, 16'h24022, 16'h0, 8'h0};
      
    end
    5'h25 : 
    begin 
      payload  <= {16'h4000, 16'h24023, 16'h0, 8'h0};
      
    end
    5'h26 : 
    begin 
      payload  <= {16'h4000, 16'h24024, 16'h0, 8'h0};
      
    end
    5'h27 : 
    begin 
      payload  <= {16'h4000, 16'h24025, 16'h0, 8'h0}; 
    end        
    default: 
    begin 
      payload  <= {16'h0, 16'h0, 16'h0, 8'h0};
    end    
  endcase
end                                            














































































endmodule // data_generator


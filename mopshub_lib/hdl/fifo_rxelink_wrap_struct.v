//
// Module mopshub_lib.fifo_RXelink_wrap.struct
//
// Created:
//          by - dcs.dcs (chipdev2.physik.uni-wuppertal.de)
//          at - 21:25:41 09/30/21
//
// Generated by Mentor Graphics' HDL Designer(TM) 2019.4 (Build 4)
//

`resetall
`timescale 1ns/10ps
module fifo_RXelink_wrap #(
   // synopsys template
   parameter Kchar_sop = 8'b00111100,  // K28.1
   parameter Kchar_eop = 8'b11011100   // K28.6
)
( 
   // Port Declarations
   input   wire           clk, 
   input   wire    [9:0]  din, 
   input   wire           din_rdy, 
   input   wire           fifo_rd_clk, 
   input   wire           fifo_wr_clk, 
   input   wire           flush_fifo, 
   input   wire           rd_en_fifo, 
   input   wire           rst, 
   output  wire    [9:0]  dout_fifo, 
   output  wire           empty_fifo, 
   output  wire           full_fifo
);


// Internal Declarations


// Local declarations

// Internal signal declarations
wire        almost_full_fifo;
reg   [9:0] din_fifo          = 0;
reg         flag_pack         = 0;
wire        prog_full_fifo;
reg         wr_en_fifo        = 0;


// Instances 
fifo_upstream fifo_upstream_elink0( 
   .dout        (dout_fifo), 
   .full        (full_fifo), 
   .empty       (empty_fifo), 
   .prog_full   (prog_full_fifo), 
   .almost_full (almost_full_fifo), 
   .din         (din), 
   .wr_en       (din_rdy), 
   .rd_en       (rd_en_fifo), 
   .rd_clk      (fifo_rd_clk), 
   .wr_clk      (fifo_wr_clk), 
   .rst         (flush_fifo)
); 

// HDL Embedded Text Block 3 test_before_Write
//what to write into the FIFO?
always@(posedge clk)
if (!rst)
begin
  wr_en_fifo      <= 1'b0;
  flag_pack       <= 1'b0;
end
else 
begin
  din_fifo        <= din;
  if(wr_en_fifo == 1)//always make sure you write only once
  begin
    wr_en_fifo   <= 1'b0;
    flag_pack    <= flag_pack;
  end
  else if(flag_pack == 1 && din_rdy == 1 && din[9:8] == 2'b11 )// ignore commas
  begin
    wr_en_fifo   <= 1'b1;
    flag_pack    <= flag_pack;
  end
  else if(flag_pack == 0 && din_rdy == 1 && din == {2'b10,Kchar_sop})// 03c = 0011 1100 SOP (if 8b10b)
  begin
    wr_en_fifo   <= 1'b1;
    flag_pack    <= 1'b1; //SOP detected. raise the flag, write everything
  end   
  else if(flag_pack == 1 && din_rdy == 1 && din != {2'b01,Kchar_eop})// not EOP means it is data //flag_pack == 1 && 
  begin
    wr_en_fifo   <= 1'b1;
    flag_pack    <= 1'b1; //SOP detected.
  end   
  else if(flag_pack == 1 && din_rdy == 1 && din == {2'b01,Kchar_eop})// 0dc = 1101 1100 (if 8b10b)
  begin
    wr_en_fifo   <= 1'b1;
    flag_pack    <= 1'b0; //EOP detected. drop the flag
  end 
  else
  begin
    wr_en_fifo   <= 1'b0;
    flag_pack    <= flag_pack;
  end 
end












































endmodule // fifo_RXelink_wrap


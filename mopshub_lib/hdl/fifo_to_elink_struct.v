//
// Module mopshub_lib.fifo_to_elink.struct
//
// Created:
//          by - dcs.dcs (chipdev2.physik.uni-wuppertal.de)
//          at - 14:59:25 08/23/21
//
// Generated by Mentor Graphics' HDL Designer(TM) 2019.4 (Build 4)
//

`resetall
`timescale 1ns/10ps
module fifo_to_elink( 
   // Port Declarations
   input   wire           fifo_wr_en, 
   input   wire           bitCLKx2, 
   input   wire           bitCLKx4, 
   input   wire           rst, 
   input   wire    [9:0]  fifo_din, 
   output  wire           tx_elink1bit, 
   output  wire    [1:0]  tx_elink2bit, 
   input   wire           fifo_flush, 
   input   wire           reverse_tx,    // 0
   input   wire           swap_rx_bits, 
   input   wire           bitCLK, 
   output  wire           efifo_full, 
   input   wire           fifo_wr_clk, 
   input   wire           fifo_rd_clk
);

// Local declarations
// Internal signal declarations
// Internal Declarations
// Internal Declarations


// Local declarations

// Internal signal declarations
wire        efifo_pfull;
reg         bitCount1          = 0;
wire  [1:0] dout2bit;                    //  @ 40MHz
wire        fifo_dout_10b_rdy;
wire  [9:0] fifo_dout_10b;               // 10-bit data in
wire        fifo_rd_en;
wire        efifo_empty;
reg         DATA1bitOUT_r      = 1'b0;


// Instances 
//  Instances
// 
elink_proc_out_enc8b10b elink_proc_out_enc8b10b0( 
   .bitCLKx4           (bitCLKx4), 
   .bitCLK             (bitCLK), 
   .EDATA_IN           (fifo_dout_10b), 
   .EDATA_RDY          (fifo_dout_10b_rdy), 
   .reverse_stream_10b (reverse_tx), 
   .swap_outbits       (swap_rx_bits), 
   .rst                (rst), 
   .getDataTrig        (fifo_rd_en), 
   .EDATA_OUT          (dout2bit)
); 

fifo_TXelink_wrap fifo_TXelink_wrap0( 
   .din            (fifo_din), 
   .flush_fifo     (fifo_flush), 
   .rd_clk         (fifo_rd_clk), 
   .rd_en          (fifo_rd_en), 
   .rst            (rst), 
   .wr_en          (fifo_wr_en), 
   .dout_efifo     (fifo_dout_10b), 
   .dout_rdy_efifo (fifo_dout_10b_rdy), 
   .empty_efifo    (efifo_empty), 
   .full_efifo     (efifo_full), 
   .prog_full      (efifo_pfull), 
   .wr_clk         (fifo_wr_clk)
); 

// HDL Embedded Text Block 1 eb1
// HDL Embedded Text Block 1 serialization
//-------------------------------------------
//-- serialization of the 2-bit data output:
//-------------------------------------------                                       
always @(posedge bitCLKx2)
begin
        bitCount1 <= ! bitCount1;
end

// HDL Embedded Text Block 2 eb2
// HDL Embedded Text Block 3 eb3
// eb3 3                                        
always @(posedge bitCLKx2)//serialized output
begin 
  if(bitCount1 == 0)
    DATA1bitOUT_r <= dout2bit[0]; //serialize the first bit
  else
    DATA1bitOUT_r <= dout2bit[1]; //serialize the second bit which is filled in the other block ?bitCount1 = 0
end

// HDL Embedded Text Block 3 eb3
// HDL Embedded Text Block 4 eb4
// eb4 4 
//2 bits @ clk80, can interface 2-bit of GBT frame                                       
assign tx_elink2bit = dout2bit;
assign tx_elink1bit =DATA1bitOUT_r; //1 bit output


endmodule // fifo_to_elink
// FIFO_to_Elink

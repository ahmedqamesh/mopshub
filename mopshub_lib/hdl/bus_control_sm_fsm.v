//
// Module mopshub_lib.bus_control_SM.fsm
//
// Created:
//          by - lschreiter.lschreiter (hoerni.telcom.fh-dortmund.de)
//          at - 12:57:12 02/23/23
//
// Generated by Mentor Graphics' HDL Designer(TM) 2020.4 Built on 12 Oct 2020 at 16:52:03
//
`resetall
`timescale 1ns/10ps
module bus_control_SM( 
   // Port Declarations
   input   wire           abort,                  // Upon receiving a reset message on the CANbus. FSM goes into a known state
   input   wire           busy_m, 
   input   wire           busy_p, 
   input   wire           clk,                    // posedge
   input   wire           cnt_done, 
   input   wire           end_cnt, 
   input   wire           end_mon_cnt, 
   input   wire           end_read_elink,         // this signal goes high when CANopen block has finshed writing transmit message buffer register 
   input   wire           end_read_miso, 
   input   wire           end_write_elink_spi, 
   input   wire           irq_spi_tra, 
   input   wire           rst,                    // synchronous low active
   input   wire           start_bus_init,         // initialize request from bridge FSM of bridge controller 
   input   wire           start_mon_init, 
   input   wire           start_power_off, 
   input   wire           start_power_on, 
   input   wire           start_read_mon, 
   input   wire           start_read_power, 
   input   wire           timeoutrst,             // timeout reset signal to the state machine in case bridge controller is not respoding for a specified time
   output  reg            bus_en_done,            // indication to bridge FSM when initialization is finished 
   output  reg            cs_m, 
   output  reg            cs_p, 
   output  reg     [7:0]  data_init,              // request to caninterface block
   output  reg            end_spi_proc, 
   output  reg            entimeout, 
   output  reg            mon_en_done, 
   output  reg            read_spi_mode, 
   output  reg            rst_mon_cnt, 
   output  reg            spi_cs, 
   output  reg            start_cnt, 
   output  reg            start_init, 
   output  reg            start_mon_cnt, 
   output  reg            start_read_elink,       // signal to read transmit message buffer register 
   output  reg            start_read_miso, 
   output  reg            start_write_elink_spi, 
   output  reg     [8:0]  statedeb,               // State debug signal 
   output  reg            transcieve_m, 
   output  reg            transcieve_p
);


// Internal Declarations


// Module Declarations

// State encoding
parameter 
          waittoact       = 9'd0,
          reset           = 9'd1,
          start           = 9'd2,
          endinit1        = 9'd3,
          start1          = 9'd4,
          ST_Read_reg     = 9'd5,
          st_GPIOA        = 9'd6,
          st_GPIOA1       = 9'd7,
          st_GPIOA2       = 9'd8,
          End_Select      = 9'd9,
          Write_Mosi      = 9'd10,
          read_elink_mes1 = 9'd11,
          CS_low          = 9'd12,
          Read_Miso       = 9'd13,
          Done            = 9'd14,
          write_elink     = 9'd15,
          Wait_Miso       = 9'd16,
          Offset_cal0     = 9'd17,
          Offset__cal1    = 9'd18,
          Offset__cal2    = 9'd19,
          Offset__cal3    = 9'd20,
          Gain_cal0       = 9'd21,
          Gain_cal1       = 9'd22,
          Gain_cal2       = 9'd23,
          Gain_cal3       = 9'd24,
          write_csrs7     = 9'd25,
          write_csrs6     = 9'd26,
          write_csrs5     = 9'd27,
          write_csrs4     = 9'd28,
          write_csrs0     = 9'd29,
          write_csrs1     = 9'd30,
          write_csrs2     = 9'd31,
          ST_Config4      = 9'd32,
          ST_Config3      = 9'd33,
          ST_Config1      = 9'd34,
          ST_Config2      = 9'd35,
          ST_Rest_2       = 9'd36,
          ST_Rest_4       = 9'd37,
          ST_Rest_1       = 9'd38,
          St_wait         = 9'd39,
          ST_Rest_RS_1    = 9'd40,
          ST_Rest_RS_2    = 9'd41,
          st_GPIOA9       = 9'd42,
          st_GPIOA10      = 9'd43,
          st_GPIOA11      = 9'd44,
          w_busy15        = 9'd45,
          w_busy16        = 9'd46,
          w_busy17        = 9'd47,
          ST_IODIRA0      = 9'd48,
          w_busy0         = 9'd49,
          ST_IODIRA1      = 9'd50,
          w_busy1         = 9'd51,
          ST_IODIRA2      = 9'd52,
          w_busy2         = 9'd53,
          w_busy5         = 9'd54,
          st_IODIRB1      = 9'd55,
          st_IODIRB2      = 9'd56,
          st_IODIRB       = 9'd57,
          w_busy3         = 9'd58,
          w_busy4         = 9'd59,
          w_busy7         = 9'd60,
          st_GPIOB2       = 9'd61,
          st_GPIOB1       = 9'd62,
          w_busy8         = 9'd63,
          w_busy6         = 9'd64,
          st_GPIOB0       = 9'd65,
          st_GPPUA        = 9'd66,
          w_busy11        = 9'd67,
          w_busy9         = 9'd68,
          st_GPPUA2       = 9'd69,
          st_GPPUA1       = 9'd70,
          w_busy10        = 9'd71,
          st_GPPUB1       = 9'd72,
          w_busy13        = 9'd73,
          w_busy12        = 9'd74,
          st_GPPUB2       = 9'd75,
          w_busy14        = 9'd76,
          st_GPPUB        = 9'd77,
          CS_high0        = 9'd78,
          CS_high1        = 9'd79,
          CS_high2        = 9'd80,
          CS_high3        = 9'd81,
          CS_high4        = 9'd82,
          CS_high5        = 9'd83,
          w_busy26        = 9'd84,
          w_busy27        = 9'd85,
          w_busy28        = 9'd86,
          w_busy29        = 9'd87,
          w_busy30        = 9'd88,
          w_busy31        = 9'd89,
          CS_high7        = 9'd90,
          w_busy32        = 9'd91,
          ST_Init_0       = 9'd92,
          ST_wait_0       = 9'd93,
          ST_Init_1       = 9'd94,
          ST_wait_1       = 9'd95,
          ST_Init_2       = 9'd96,
          ST_wait_2       = 9'd97,
          ST_Init_3       = 9'd98,
          ST_wait_3       = 9'd99,
          ST_Init_4       = 9'd100,
          ST_wait_4       = 9'd101,
          ST_Init_5       = 9'd102,
          ST_wait_5       = 9'd103,
          ST_Init_6       = 9'd104,
          ST_wait_6       = 9'd105,
          ST_Init_7       = 9'd106,
          ST_wait_7       = 9'd107,
          ST_Init_8       = 9'd108,
          ST_wait_8       = 9'd109,
          ST_Init_9       = 9'd110,
          ST_wait_9       = 9'd111,
          ST_Init_10      = 9'd112,
          ST_wait_10      = 9'd113,
          ST_Init_11      = 9'd114,
          ST_wait_11      = 9'd115,
          ST_Init_12      = 9'd116,
          ST_wait_12      = 9'd117,
          ST_Init_13      = 9'd118,
          ST_wait_13      = 9'd119,
          ST_Init_14      = 9'd120,
          ST_wait_14      = 9'd121,
          st_Init_2       = 9'd122,
          ST_wait_15      = 9'd123,
          CS_high8        = 9'd124,
          w_busy33        = 9'd125,
          ST_Rest_3       = 9'd126,
          ST_Rest_RS_3    = 9'd127,
          ST_Rest_RS_4    = 9'd128,
          St_wait1        = 9'd129,
          St_wait5        = 9'd130,
          St_wait6        = 9'd131,
          St_wait7        = 9'd132,
          St_wait8        = 9'd133,
          St_wait9        = 9'd134,
          St_wait10       = 9'd135,
          CS_high9        = 9'd136,
          w_busy34        = 9'd137,
          St_wait13       = 9'd138,
          ST_Rest_RS_6    = 9'd139,
          ST_Rest_RS_7    = 9'd140,
          St_wait14       = 9'd141,
          ST_Rest_RS_8    = 9'd142,
          St_wait15       = 9'd143,
          St_wait16       = 9'd144,
          CS_high10       = 9'd145,
          w_busy35        = 9'd146,
          CS_high12       = 9'd147,
          w_busy36        = 9'd148,
          CS_high13       = 9'd149,
          w_busy37        = 9'd150,
          w_busy38        = 9'd151,
          CS_high14       = 9'd152,
          CS_high15       = 9'd153,
          w_busy39        = 9'd154,
          St_wait17       = 9'd155,
          St_wait18       = 9'd156,
          St_wait19       = 9'd157,
          St_wait20       = 9'd158,
          St_wait32       = 9'd159,
          St_wait33       = 9'd160,
          St_wait34       = 9'd161,
          ST_Config5      = 9'd162,
          ST_Config6      = 9'd163,
          St_wait35       = 9'd164,
          ST_Config7      = 9'd165,
          St_wait36       = 9'd166,
          ST_Config8      = 9'd167,
          St_wait37       = 9'd168,
          ST_Config9      = 9'd169,
          St_wait38       = 9'd170,
          ST_Config10     = 9'd171,
          St_wait39       = 9'd172,
          St_wait40       = 9'd173,
          ST_Config11     = 9'd174,
          St_wait41       = 9'd175,
          ST_Config12     = 9'd176,
          St_wait42       = 9'd177,
          ST_Config13     = 9'd178,
          St_wait43       = 9'd179,
          St_wait44       = 9'd180,
          ST_Config14     = 9'd181,
          St_wait45       = 9'd182,
          ST_Config15     = 9'd183,
          St_wait46       = 9'd184,
          ST_Config16     = 9'd185,
          St_wait47       = 9'd186,
          St_wait25       = 9'd187,
          St_wait26       = 9'd188,
          St_wait27       = 9'd189,
          St_wait28       = 9'd190,
          St_wait29       = 9'd191,
          St_wait30       = 9'd192,
          St_wait31       = 9'd193,
          ST_Read_reg2    = 9'd194,
          St_wait21       = 9'd195,
          ST_Rest_RS_9    = 9'd196,
          ST_Rest_RS_10   = 9'd197,
          St_wait22       = 9'd198,
          ST_Rest_RS_11   = 9'd199,
          St_wait23       = 9'd200,
          St_wait24       = 9'd201,
          ST_Config17     = 9'd202,
          St_wait48       = 9'd203,
          ST_Config18     = 9'd204,
          St_wait49       = 9'd205,
          St_wait50       = 9'd206,
          St_wait51       = 9'd207,
          ST_Config19     = 9'd208,
          St_wait52       = 9'd209,
          ST_Config20     = 9'd210,
          St_wait53       = 9'd211,
          St_wait54       = 9'd212,
          ST_Config21     = 9'd213,
          St_wait55       = 9'd214,
          ST_Config22     = 9'd215,
          St_wait56       = 9'd216,
          St_wait57       = 9'd217,
          ST_Config23     = 9'd218,
          St_wait58       = 9'd219,
          ST_Config24     = 9'd220,
          St_wait59       = 9'd221,
          Break_Loop      = 9'd222,
          ST_CountRst     = 9'd223,
          ST_Start_Cnt    = 9'd224,
          ST_Read_reg3    = 9'd225,
          St_wait60       = 9'd226,
          ST_Rest_RS_12   = 9'd227,
          ST_Rest_RS_13   = 9'd228,
          St_wait61       = 9'd229,
          ST_Rest_RS_14   = 9'd230,
          St_wait62       = 9'd231,
          St_wait63       = 9'd232,
          CS_high16       = 9'd233,
          w_busy43        = 9'd234,
          st_GPIOA15      = 9'd235,
          st_GPIOA16      = 9'd236,
          st_GPIOA17      = 9'd237,
          w_busy40        = 9'd238,
          w_busy41        = 9'd239,
          w_busy42        = 9'd240,
          CS_high6        = 9'd241,
          w_busy44        = 9'd242,
          CS_high17       = 9'd243,
          w_busy48        = 9'd244,
          st_GPIOA12      = 9'd245,
          st_GPIOA13      = 9'd246,
          st_GPIOA14      = 9'd247,
          w_busy18        = 9'd248,
          w_busy19        = 9'd249,
          w_busy20        = 9'd250,
          st_GPIOA18      = 9'd251,
          st_GPIOA19      = 9'd252,
          st_GPIOA20      = 9'd253,
          w_busy45        = 9'd254,
          w_busy46        = 9'd255,
          w_busy47        = 9'd256,
          CS_high11       = 9'd257,
          w_busy49        = 9'd258,
          CS_high18       = 9'd259,
          w_busy53        = 9'd260,
          st_GPIOA21      = 9'd261,
          st_GPIOA22      = 9'd262,
          st_GPIOA23      = 9'd263,
          w_busy21        = 9'd264,
          w_busy22        = 9'd265,
          w_busy23        = 9'd266,
          st_GPIOA24      = 9'd267,
          st_GPIOA25      = 9'd268,
          st_GPIOA26      = 9'd269,
          w_busy50        = 9'd270,
          w_busy51        = 9'd271,
          w_busy52        = 9'd272,
          s0              = 9'd273,
          s1              = 9'd274;

reg [8:0] current_state, next_state;

// Wait State Signals
reg [5:0] csm_timer;
reg [5:0] csm_next_timer;
reg       csm_timeout;
reg       csm_to_CS_low;
reg       csm_to_Read_Miso;

//-----------------------------------------------------------------
// Next State Block for machine csm
//-----------------------------------------------------------------
always @(
   busy_m, 
   busy_p, 
   csm_timeout, 
   current_state, 
   end_mon_cnt, 
   end_read_elink, 
   end_read_miso, 
   end_write_elink_spi, 
   irq_spi_tra, 
   rst, 
   start_bus_init, 
   start_mon_init, 
   start_power_off, 
   start_power_on, 
   start_read_mon, 
   start_read_power
)
begin : next_state_block_proc
   // Default assignments to Wait State entry flags
   csm_to_CS_low = 1'b0;
   csm_to_Read_Miso = 1'b0;
   case (current_state) 
      waittoact: begin
         if (start_bus_init  == 1)
            next_state = start;
         else if (start_mon_init ==1)
            next_state = start1;
         else if (start_power_on ==1)
            next_state = s0;
         else if (start_power_off ==1)
            next_state = s1;
         else if (start_read_mon ==1)
            next_state = ST_Read_reg3;
         else if (irq_spi_tra ==1)
            next_state = read_elink_mes1;
         else if (start_read_power ==1)
            next_state = st_GPIOA9;
         else
            next_state = waittoact;
      end
      reset: begin
         if (rst == 1)
            next_state = waittoact;
         else
            next_state = reset;
      end
      start: begin
         next_state = ST_IODIRA0;
      end
      endinit1: begin
         next_state = waittoact;
      end
      start1: begin
         next_state = ST_Init_0;
      end
      ST_Read_reg: begin
         next_state = St_wait16;
      end
      st_GPIOA: begin
         next_state = w_busy15;
      end
      st_GPIOA1: begin
         next_state = w_busy16;
      end
      st_GPIOA2: begin
         next_state = w_busy17;
      end
      End_Select: begin
         next_state = waittoact;
      end
      Write_Mosi: begin
         next_state = CS_low;
         csm_to_CS_low = 1'b1;
      end
      read_elink_mes1: begin
         if (end_read_elink == 1)
            next_state = Write_Mosi;
         else
            next_state = read_elink_mes1;
      end
      CS_low: begin
         if (csm_timeout) begin
            next_state = Read_Miso;
            csm_to_Read_Miso = 1'b1;
         end
         else
            next_state = CS_low;
      end
      Read_Miso: begin
         if (csm_timeout)
            next_state = Wait_Miso;
         else
            next_state = Read_Miso;
      end
      Done: begin
         next_state = waittoact;
      end
      write_elink: begin
         if (end_write_elink_spi ==1)
            next_state = Done;
         else
            next_state = write_elink;
      end
      Wait_Miso: begin
         if (end_read_miso == 1)
            next_state = write_elink;
         else
            next_state = Wait_Miso;
      end
      Offset_cal0: begin
         next_state = St_wait32;
      end
      Offset__cal1: begin
         next_state = St_wait33;
      end
      Offset__cal2: begin
         next_state = St_wait40;
      end
      Offset__cal3: begin
         next_state = St_wait44;
      end
      Gain_cal0: begin
         next_state = St_wait50;
      end
      Gain_cal1: begin
         next_state = St_wait51;
      end
      Gain_cal2: begin
         next_state = St_wait54;
      end
      Gain_cal3: begin
         next_state = St_wait57;
      end
      write_csrs7: begin
         next_state = St_wait31;
      end
      write_csrs6: begin
         next_state = St_wait30;
      end
      write_csrs5: begin
         next_state = St_wait29;
      end
      write_csrs4: begin
         next_state = St_wait28;
      end
      write_csrs0: begin
         next_state = St_wait25;
      end
      write_csrs1: begin
         next_state = St_wait26;
      end
      write_csrs2: begin
         next_state = St_wait27;
      end
      ST_Config4: begin
         next_state = St_wait20;
      end
      ST_Config3: begin
         next_state = St_wait19;
      end
      ST_Config1: begin
         next_state = St_wait18;
      end
      ST_Config2: begin
         next_state = St_wait17;
      end
      ST_Rest_2: begin
         next_state = St_wait1;
      end
      ST_Rest_4: begin
         next_state = St_wait6;
      end
      ST_Rest_1: begin
         next_state = St_wait;
      end
      St_wait: begin
         if (busy_m==1)
            next_state = ST_Rest_2;
         else
            next_state = St_wait;
      end
      ST_Rest_RS_1: begin
         next_state = St_wait7;
      end
      ST_Rest_RS_2: begin
         next_state = St_wait8;
      end
      st_GPIOA9: begin
         next_state = st_GPIOA10;
      end
      st_GPIOA10: begin
         next_state = st_GPIOA11;
      end
      st_GPIOA11: begin
         next_state = waittoact;
      end
      w_busy15: begin
         if (busy_p==1)
            next_state = st_GPIOA1;
         else
            next_state = w_busy15;
      end
      w_busy16: begin
         if (busy_p==1)
            next_state = st_GPIOA2;
         else
            next_state = w_busy16;
      end
      w_busy17: begin
         if (busy_p==1)
            next_state = CS_high5;
         else
            next_state = w_busy17;
      end
      ST_IODIRA0: begin
         next_state = w_busy0;
      end
      w_busy0: begin
         if (busy_p==1)
            next_state = ST_IODIRA1;
         else
            next_state = w_busy0;
      end
      ST_IODIRA1: begin
         next_state = w_busy1;
      end
      w_busy1: begin
         if (busy_p==1)
            next_state = ST_IODIRA2;
         else
            next_state = w_busy1;
      end
      ST_IODIRA2: begin
         next_state = w_busy2;
      end
      w_busy2: begin
         if (busy_p==1)
            next_state = CS_high0;
         else
            next_state = w_busy2;
      end
      w_busy5: begin
         if (busy_p==1)
            next_state = CS_high1;
         else
            next_state = w_busy5;
      end
      st_IODIRB1: begin
         next_state = w_busy4;
      end
      st_IODIRB2: begin
         next_state = w_busy5;
      end
      st_IODIRB: begin
         next_state = w_busy3;
      end
      w_busy3: begin
         if (busy_p==1)
            next_state = st_IODIRB1;
         else
            next_state = w_busy3;
      end
      w_busy4: begin
         if (busy_p==1)
            next_state = st_IODIRB2;
         else
            next_state = w_busy4;
      end
      w_busy7: begin
         if (busy_p==1)
            next_state = st_GPIOB2;
         else
            next_state = w_busy7;
      end
      st_GPIOB2: begin
         next_state = w_busy8;
      end
      st_GPIOB1: begin
         next_state = w_busy7;
      end
      w_busy8: begin
         if (busy_p==1)
            next_state = CS_high2;
         else
            next_state = w_busy8;
      end
      w_busy6: begin
         if (busy_p==1)
            next_state = st_GPIOB1;
         else
            next_state = w_busy6;
      end
      st_GPIOB0: begin
         next_state = w_busy6;
      end
      st_GPPUA: begin
         next_state = w_busy9;
      end
      w_busy11: begin
         if (busy_p==1)
            next_state = st_GPPUA2;
         else
            next_state = w_busy11;
      end
      w_busy9: begin
         if (busy_p==1)
            next_state = st_GPPUA1;
         else
            next_state = w_busy9;
      end
      st_GPPUA2: begin
         next_state = w_busy10;
      end
      st_GPPUA1: begin
         next_state = w_busy11;
      end
      w_busy10: begin
         if (busy_p==1)
            next_state = CS_high3;
         else
            next_state = w_busy10;
      end
      st_GPPUB1: begin
         next_state = w_busy13;
      end
      w_busy13: begin
         if (busy_p==1)
            next_state = st_GPPUB2;
         else
            next_state = w_busy13;
      end
      w_busy12: begin
         if (busy_p==1)
            next_state = st_GPPUB1;
         else
            next_state = w_busy12;
      end
      st_GPPUB2: begin
         next_state = w_busy14;
      end
      w_busy14: begin
         if (busy_p==1)
            next_state = CS_high4;
         else
            next_state = w_busy14;
      end
      st_GPPUB: begin
         next_state = w_busy12;
      end
      CS_high0: begin
         next_state = w_busy26;
      end
      CS_high1: begin
         next_state = w_busy27;
      end
      CS_high2: begin
         next_state = w_busy28;
      end
      CS_high3: begin
         next_state = w_busy29;
      end
      CS_high4: begin
         next_state = w_busy30;
      end
      CS_high5: begin
         next_state = w_busy31;
      end
      w_busy26: begin
         if (busy_p==1)
            next_state = st_IODIRB;
         else
            next_state = w_busy26;
      end
      w_busy27: begin
         if (busy_p==1)
            next_state = st_GPIOB0;
         else
            next_state = w_busy27;
      end
      w_busy28: begin
         if (busy_p==1)
            next_state = st_GPPUA;
         else
            next_state = w_busy28;
      end
      w_busy29: begin
         if (busy_p==1)
            next_state = st_GPPUB;
         else
            next_state = w_busy29;
      end
      w_busy30: begin
         if (busy_p==1)
            next_state = st_GPIOA;
         else
            next_state = w_busy30;
      end
      w_busy31: begin
         if (busy_p==1)
            next_state = st_GPIOA15;
         else
            next_state = w_busy31;
      end
      CS_high7: begin
         next_state = w_busy32;
      end
      w_busy32: begin
         if (busy_m==1)
            next_state = ST_Rest_1;
         else
            next_state = w_busy32;
      end
      ST_Init_0: begin
         next_state = ST_wait_0;
      end
      ST_wait_0: begin
         if (busy_m==1)
            next_state = ST_Init_1;
         else
            next_state = ST_wait_0;
      end
      ST_Init_1: begin
         next_state = ST_wait_1;
      end
      ST_wait_1: begin
         if (busy_m==1)
            next_state = ST_Init_2;
         else
            next_state = ST_wait_1;
      end
      ST_Init_2: begin
         next_state = ST_wait_2;
      end
      ST_wait_2: begin
         if (busy_m==1)
            next_state = ST_Init_3;
         else
            next_state = ST_wait_2;
      end
      ST_Init_3: begin
         next_state = ST_wait_3;
      end
      ST_wait_3: begin
         if (busy_m==1)
            next_state = ST_Init_4;
         else
            next_state = ST_wait_3;
      end
      ST_Init_4: begin
         next_state = ST_wait_4;
      end
      ST_wait_4: begin
         if (busy_m==1)
            next_state = ST_Init_5;
         else
            next_state = ST_wait_4;
      end
      ST_Init_5: begin
         next_state = ST_wait_5;
      end
      ST_wait_5: begin
         if (busy_m==1)
            next_state = ST_Init_6;
         else
            next_state = ST_wait_5;
      end
      ST_Init_6: begin
         next_state = ST_wait_6;
      end
      ST_wait_6: begin
         if (busy_m==1)
            next_state = ST_Init_7;
         else
            next_state = ST_wait_6;
      end
      ST_Init_7: begin
         next_state = ST_wait_7;
      end
      ST_wait_7: begin
         if (busy_m==1)
            next_state = ST_Init_8;
         else
            next_state = ST_wait_7;
      end
      ST_Init_8: begin
         next_state = ST_wait_8;
      end
      ST_wait_8: begin
         if (busy_m==1)
            next_state = ST_Init_9;
         else
            next_state = ST_wait_8;
      end
      ST_Init_9: begin
         next_state = ST_wait_9;
      end
      ST_wait_9: begin
         if (busy_m==1)
            next_state = ST_Init_10;
         else
            next_state = ST_wait_9;
      end
      ST_Init_10: begin
         next_state = ST_wait_10;
      end
      ST_wait_10: begin
         if (busy_m==1)
            next_state = ST_Init_11;
         else
            next_state = ST_wait_10;
      end
      ST_Init_11: begin
         next_state = ST_wait_11;
      end
      ST_wait_11: begin
         if (busy_m==1)
            next_state = ST_Init_12;
         else
            next_state = ST_wait_11;
      end
      ST_Init_12: begin
         next_state = ST_wait_12;
      end
      ST_wait_12: begin
         if (busy_m==1)
            next_state = ST_Init_13;
         else
            next_state = ST_wait_12;
      end
      ST_Init_13: begin
         next_state = ST_wait_13;
      end
      ST_wait_13: begin
         if (busy_m==1)
            next_state = ST_Init_14;
         else
            next_state = ST_wait_13;
      end
      ST_Init_14: begin
         next_state = ST_wait_14;
      end
      ST_wait_14: begin
         if (busy_m==1)
            next_state = st_Init_2;
         else
            next_state = ST_wait_14;
      end
      st_Init_2: begin
         next_state = ST_wait_15;
      end
      ST_wait_15: begin
         if (busy_m==1)
            next_state = CS_high7;
         else
            next_state = ST_wait_15;
      end
      CS_high8: begin
         next_state = w_busy33;
      end
      w_busy33: begin
         if (busy_m==1)
            next_state = ST_Read_reg;
         else
            next_state = w_busy33;
      end
      ST_Rest_3: begin
         next_state = St_wait5;
      end
      ST_Rest_RS_3: begin
         next_state = St_wait9;
      end
      ST_Rest_RS_4: begin
         next_state = St_wait10;
      end
      St_wait1: begin
         if (busy_m==1)
            next_state = ST_Rest_3;
         else
            next_state = St_wait1;
      end
      St_wait5: begin
         next_state = ST_Rest_4;
      end
      St_wait6: begin
         if (busy_m==1)
            next_state = ST_Rest_RS_1;
         else
            next_state = St_wait6;
      end
      St_wait7: begin
         if (busy_m==1)
            next_state = ST_Rest_RS_2;
         else
            next_state = St_wait7;
      end
      St_wait8: begin
         if (busy_m==1)
            next_state = ST_Rest_RS_3;
         else
            next_state = St_wait8;
      end
      St_wait9: begin
         if (busy_m==1)
            next_state = ST_Rest_RS_4;
         else
            next_state = St_wait9;
      end
      St_wait10: begin
         if (busy_m==1)
            next_state = CS_high8;
         else
            next_state = St_wait10;
      end
      CS_high9: begin
         next_state = w_busy34;
      end
      w_busy34: begin
         if (busy_m==1)
            next_state = ST_Config1;
         else
            next_state = w_busy34;
      end
      St_wait13: begin
         if (busy_m==1)
            next_state = ST_Rest_RS_6;
         else
            next_state = St_wait13;
      end
      ST_Rest_RS_6: begin
         next_state = St_wait14;
      end
      ST_Rest_RS_7: begin
         next_state = St_wait13;
      end
      St_wait14: begin
         if (busy_m==1)
            next_state = ST_Rest_RS_8;
         else
            next_state = St_wait14;
      end
      ST_Rest_RS_8: begin
         next_state = St_wait15;
      end
      St_wait15: begin
         if (busy_m==1)
            next_state = CS_high9;
         else
            next_state = St_wait15;
      end
      St_wait16: begin
         if (busy_m==1)
            next_state = ST_Rest_RS_7;
         else
            next_state = St_wait16;
      end
      CS_high10: begin
         next_state = w_busy35;
      end
      w_busy35: begin
         if (busy_m==1)
            next_state = ST_Read_reg2;
         else
            next_state = w_busy35;
      end
      CS_high12: begin
         next_state = w_busy36;
      end
      w_busy36: begin
         if (busy_m==1)
            next_state = write_csrs0;
         else
            next_state = w_busy36;
      end
      CS_high13: begin
         next_state = w_busy37;
      end
      w_busy37: begin
         if (busy_m==1)
            next_state = Offset_cal0;
         else
            next_state = w_busy37;
      end
      w_busy38: begin
         if (busy_m==1)
            next_state = Gain_cal0;
         else
            next_state = w_busy38;
      end
      CS_high14: begin
         next_state = w_busy38;
      end
      CS_high15: begin
         next_state = w_busy39;
      end
      w_busy39: begin
         if (busy_m==1)
            next_state = Break_Loop;
         else
            next_state = w_busy39;
      end
      St_wait17: begin
         if (busy_m==1)
            next_state = ST_Config3;
         else
            next_state = St_wait17;
      end
      St_wait18: begin
         if (busy_m==1)
            next_state = ST_Config2;
         else
            next_state = St_wait18;
      end
      St_wait19: begin
         if (busy_m==1)
            next_state = ST_Config4;
         else
            next_state = St_wait19;
      end
      St_wait20: begin
         if (busy_m==1)
            next_state = CS_high10;
         else
            next_state = St_wait20;
      end
      St_wait32: begin
         if (busy_m==1)
            next_state = ST_Config5;
         else
            next_state = St_wait32;
      end
      St_wait33: begin
         if (busy_m==1)
            next_state = ST_Config8;
         else
            next_state = St_wait33;
      end
      St_wait34: begin
         if (busy_m==1)
            next_state = Offset__cal1;
         else
            next_state = St_wait34;
      end
      ST_Config5: begin
         next_state = St_wait35;
      end
      ST_Config6: begin
         next_state = St_wait34;
      end
      St_wait35: begin
         if (busy_m==1)
            next_state = ST_Config7;
         else
            next_state = St_wait35;
      end
      ST_Config7: begin
         next_state = St_wait36;
      end
      St_wait36: begin
         if (busy_m==1)
            next_state = ST_Config6;
         else
            next_state = St_wait36;
      end
      ST_Config8: begin
         next_state = St_wait37;
      end
      St_wait37: begin
         if (busy_m==1)
            next_state = ST_Config9;
         else
            next_state = St_wait37;
      end
      ST_Config9: begin
         next_state = St_wait38;
      end
      St_wait38: begin
         if (busy_m==1)
            next_state = ST_Config10;
         else
            next_state = St_wait38;
      end
      ST_Config10: begin
         next_state = St_wait39;
      end
      St_wait39: begin
         if (busy_m==1)
            next_state = Offset__cal2;
         else
            next_state = St_wait39;
      end
      St_wait40: begin
         if (busy_m==1)
            next_state = ST_Config11;
         else
            next_state = St_wait40;
      end
      ST_Config11: begin
         next_state = St_wait41;
      end
      St_wait41: begin
         if (busy_m==1)
            next_state = ST_Config12;
         else
            next_state = St_wait41;
      end
      ST_Config12: begin
         next_state = St_wait42;
      end
      St_wait42: begin
         if (busy_m==1)
            next_state = ST_Config13;
         else
            next_state = St_wait42;
      end
      ST_Config13: begin
         next_state = St_wait43;
      end
      St_wait43: begin
         if (busy_m==1)
            next_state = Offset__cal3;
         else
            next_state = St_wait43;
      end
      St_wait44: begin
         if (busy_m==1)
            next_state = ST_Config14;
         else
            next_state = St_wait44;
      end
      ST_Config14: begin
         next_state = St_wait45;
      end
      St_wait45: begin
         if (busy_m==1)
            next_state = ST_Config15;
         else
            next_state = St_wait45;
      end
      ST_Config15: begin
         next_state = St_wait46;
      end
      St_wait46: begin
         if (busy_m==1)
            next_state = ST_Config16;
         else
            next_state = St_wait46;
      end
      ST_Config16: begin
         next_state = St_wait47;
      end
      St_wait47: begin
         if (busy_m==1)
            next_state = CS_high14;
         else
            next_state = St_wait47;
      end
      St_wait25: begin
         if (busy_m==1)
            next_state = write_csrs1;
         else
            next_state = St_wait25;
      end
      St_wait26: begin
         if (busy_m==1)
            next_state = write_csrs2;
         else
            next_state = St_wait26;
      end
      St_wait27: begin
         if (busy_m==1)
            next_state = write_csrs4;
         else
            next_state = St_wait27;
      end
      St_wait28: begin
         if (busy_m==1)
            next_state = write_csrs5;
         else
            next_state = St_wait28;
      end
      St_wait29: begin
         if (busy_m==1)
            next_state = write_csrs6;
         else
            next_state = St_wait29;
      end
      St_wait30: begin
         if (busy_m==1)
            next_state = write_csrs7;
         else
            next_state = St_wait30;
      end
      St_wait31: begin
         if (busy_m==1)
            next_state = CS_high13;
         else
            next_state = St_wait31;
      end
      ST_Read_reg2: begin
         next_state = St_wait24;
      end
      St_wait21: begin
         if (busy_m==1)
            next_state = ST_Rest_RS_9;
         else
            next_state = St_wait21;
      end
      ST_Rest_RS_9: begin
         next_state = St_wait22;
      end
      ST_Rest_RS_10: begin
         next_state = St_wait21;
      end
      St_wait22: begin
         if (busy_m==1)
            next_state = ST_Rest_RS_11;
         else
            next_state = St_wait22;
      end
      ST_Rest_RS_11: begin
         next_state = St_wait23;
      end
      St_wait23: begin
         if (busy_m==1)
            next_state = CS_high12;
         else
            next_state = St_wait23;
      end
      St_wait24: begin
         if (busy_m==1)
            next_state = ST_Rest_RS_10;
         else
            next_state = St_wait24;
      end
      ST_Config17: begin
         next_state = St_wait48;
      end
      St_wait48: begin
         if (busy_m==1)
            next_state = ST_Config18;
         else
            next_state = St_wait48;
      end
      ST_Config18: begin
         next_state = St_wait49;
      end
      St_wait49: begin
         if (busy_m==1)
            next_state = Gain_cal1;
         else
            next_state = St_wait49;
      end
      St_wait50: begin
         if (busy_m==1)
            next_state = ST_Config17;
         else
            next_state = St_wait50;
      end
      St_wait51: begin
         if (busy_m==1)
            next_state = ST_Config19;
         else
            next_state = St_wait51;
      end
      ST_Config19: begin
         next_state = St_wait52;
      end
      St_wait52: begin
         if (busy_m==1)
            next_state = ST_Config20;
         else
            next_state = St_wait52;
      end
      ST_Config20: begin
         next_state = St_wait53;
      end
      St_wait53: begin
         if (busy_m==1)
            next_state = Gain_cal2;
         else
            next_state = St_wait53;
      end
      St_wait54: begin
         if (busy_m==1)
            next_state = ST_Config21;
         else
            next_state = St_wait54;
      end
      ST_Config21: begin
         next_state = St_wait55;
      end
      St_wait55: begin
         if (busy_m==1)
            next_state = ST_Config22;
         else
            next_state = St_wait55;
      end
      ST_Config22: begin
         next_state = St_wait56;
      end
      St_wait56: begin
         if (busy_m==1)
            next_state = Gain_cal3;
         else
            next_state = St_wait56;
      end
      St_wait57: begin
         if (busy_m==1)
            next_state = ST_Config23;
         else
            next_state = St_wait57;
      end
      ST_Config23: begin
         next_state = St_wait58;
      end
      St_wait58: begin
         if (busy_m==1)
            next_state = ST_Config24;
         else
            next_state = St_wait58;
      end
      ST_Config24: begin
         next_state = St_wait59;
      end
      St_wait59: begin
         if (busy_m==1)
            next_state = CS_high15;
         else
            next_state = St_wait59;
      end
      Break_Loop: begin
         if (end_mon_cnt)
            next_state = ST_CountRst;
         else
            next_state = ST_Start_Cnt;
      end
      ST_CountRst: begin
         next_state = endinit1;
      end
      ST_Start_Cnt: begin
         next_state = ST_Init_0;
      end
      ST_Read_reg3: begin
         next_state = St_wait63;
      end
      St_wait60: begin
         if (busy_m==1)
            next_state = ST_Rest_RS_12;
         else
            next_state = St_wait60;
      end
      ST_Rest_RS_12: begin
         next_state = St_wait61;
      end
      ST_Rest_RS_13: begin
         next_state = St_wait60;
      end
      St_wait61: begin
         if (busy_m==1)
            next_state = ST_Rest_RS_14;
         else
            next_state = St_wait61;
      end
      ST_Rest_RS_14: begin
         next_state = St_wait62;
      end
      St_wait62: begin
         if (busy_m==1)
            next_state = waittoact;
         else
            next_state = St_wait62;
      end
      St_wait63: begin
         if (busy_m==1)
            next_state = ST_Rest_RS_13;
         else
            next_state = St_wait63;
      end
      CS_high16: begin
         next_state = w_busy43;
      end
      w_busy43: begin
         if (busy_p==1)
            next_state = End_Select;
         else
            next_state = w_busy43;
      end
      st_GPIOA15: begin
         next_state = w_busy40;
      end
      st_GPIOA16: begin
         next_state = w_busy41;
      end
      st_GPIOA17: begin
         next_state = w_busy42;
      end
      w_busy40: begin
         if (busy_p==1)
            next_state = st_GPIOA16;
         else
            next_state = w_busy40;
      end
      w_busy41: begin
         if (busy_p==1)
            next_state = st_GPIOA17;
         else
            next_state = w_busy41;
      end
      w_busy42: begin
         if (busy_p==1)
            next_state = CS_high16;
         else
            next_state = w_busy42;
      end
      CS_high6: begin
         next_state = w_busy44;
      end
      w_busy44: begin
         if (busy_p==1)
            next_state = st_GPIOA18;
         else
            next_state = w_busy44;
      end
      CS_high17: begin
         next_state = w_busy48;
      end
      w_busy48: begin
         if (busy_p==1)
            next_state = waittoact;
         else
            next_state = w_busy48;
      end
      st_GPIOA12: begin
         next_state = w_busy18;
      end
      st_GPIOA13: begin
         next_state = w_busy19;
      end
      st_GPIOA14: begin
         next_state = w_busy20;
      end
      w_busy18: begin
         if (busy_p==1)
            next_state = st_GPIOA13;
         else
            next_state = w_busy18;
      end
      w_busy19: begin
         if (busy_p==1)
            next_state = st_GPIOA14;
         else
            next_state = w_busy19;
      end
      w_busy20: begin
         if (busy_p==1)
            next_state = CS_high6;
         else
            next_state = w_busy20;
      end
      st_GPIOA18: begin
         next_state = w_busy45;
      end
      st_GPIOA19: begin
         next_state = w_busy46;
      end
      st_GPIOA20: begin
         next_state = w_busy47;
      end
      w_busy45: begin
         if (busy_p==1)
            next_state = st_GPIOA19;
         else
            next_state = w_busy45;
      end
      w_busy46: begin
         if (busy_p==1)
            next_state = st_GPIOA20;
         else
            next_state = w_busy46;
      end
      w_busy47: begin
         if (busy_p==1)
            next_state = CS_high17;
         else
            next_state = w_busy47;
      end
      CS_high11: begin
         next_state = w_busy49;
      end
      w_busy49: begin
         if (busy_p==1)
            next_state = st_GPIOA24;
         else
            next_state = w_busy49;
      end
      CS_high18: begin
         next_state = w_busy53;
      end
      w_busy53: begin
         if (busy_p==1)
            next_state = waittoact;
         else
            next_state = w_busy53;
      end
      st_GPIOA21: begin
         next_state = w_busy21;
      end
      st_GPIOA22: begin
         next_state = w_busy22;
      end
      st_GPIOA23: begin
         next_state = w_busy23;
      end
      w_busy21: begin
         if (busy_p==1)
            next_state = st_GPIOA22;
         else
            next_state = w_busy21;
      end
      w_busy22: begin
         if (busy_p==1)
            next_state = st_GPIOA23;
         else
            next_state = w_busy22;
      end
      w_busy23: begin
         if (busy_p==1)
            next_state = CS_high11;
         else
            next_state = w_busy23;
      end
      st_GPIOA24: begin
         next_state = w_busy50;
      end
      st_GPIOA25: begin
         next_state = w_busy51;
      end
      st_GPIOA26: begin
         next_state = w_busy52;
      end
      w_busy50: begin
         if (busy_p==1)
            next_state = st_GPIOA25;
         else
            next_state = w_busy50;
      end
      w_busy51: begin
         if (busy_p==1)
            next_state = st_GPIOA26;
         else
            next_state = w_busy51;
      end
      w_busy52: begin
         if (busy_p==1)
            next_state = CS_high18;
         else
            next_state = w_busy52;
      end
      s0: begin
         next_state = st_GPIOA12;
      end
      s1: begin
         next_state = st_GPIOA21;
      end
      default: 
         next_state = reset;
   endcase
end // Next State Block

//-----------------------------------------------------------------
// Output Block for machine csm
//-----------------------------------------------------------------
always @(
   current_state
)
begin : output_block_proc
   // Default Assignment
   bus_en_done = 0;
   cs_m = 1;
   cs_p = 1;
   data_init = 8'b0;
   end_spi_proc = 0;
   entimeout = 1;
   mon_en_done = 0;
   read_spi_mode = 0;
   rst_mon_cnt = 0;
   spi_cs = 1;
   start_cnt = 0;
   start_init = 0;
   start_mon_cnt = 0;
   start_read_elink = 0;
   start_read_miso = 0;
   start_write_elink_spi = 0;
   transcieve_m = 0;
   transcieve_p = 0;

   // Combined Actions
   case (current_state) 
      waittoact: begin
         entimeout =0;
      end
      reset: begin
         read_spi_mode =0;
      end
      start: begin
         start_init =1;
      end
      endinit1: begin
         mon_en_done=1;
      end
      start1: begin
         start_init =1;
      end
      ST_Read_reg: begin
         data_init = 8'h0B;
         cs_m = 0 ;
         transcieve_m =1;
      end
      st_GPIOA: begin
         data_init =8'h40;
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_GPIOA1: begin
         data_init =8'h12;
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_GPIOA2: begin
         data_init =8'h01;
         cs_p = 0 ;
         transcieve_p =1;
      end
      End_Select: begin
         bus_en_done =1;
      end
      Write_Mosi: begin
         spi_cs =0;
         read_spi_mode =1;
      end
      read_elink_mes1: begin
         start_read_elink = 1 ;
         read_spi_mode =1;
      end
      CS_low: begin
         spi_cs = 0;
         read_spi_mode =1;
      end
      Read_Miso: begin
         start_read_miso =1;
         spi_cs = 0;
         read_spi_mode =1;
      end
      Done: begin
         end_spi_proc =1;
         read_spi_mode =1;
      end
      write_elink: begin
         start_write_elink_spi =1;
         read_spi_mode =1;
      end
      Wait_Miso: begin
         read_spi_mode =1;
      end
      Offset_cal0: begin
         data_init = 8'h81;
         cs_m =0 ;
         transcieve_m =1;
      end
      Offset__cal1: begin
         data_init = 8'h89;
         cs_m =0 ;
         transcieve_m =1;
      end
      Offset__cal2: begin
         data_init = 8'h91;
         cs_m =0 ;
         transcieve_m =1;
      end
      Offset__cal3: begin
         data_init = 8'h99;
         cs_m =0 ;
         transcieve_m =1;
      end
      Gain_cal0: begin
         data_init = 8'h82;
         cs_m =0 ;
         transcieve_m =1;
      end
      Gain_cal1: begin
         data_init = 8'h8A;
         cs_m =0 ;
         transcieve_m =1;
      end
      Gain_cal2: begin
         data_init = 8'h92;
         cs_m =0 ;
         transcieve_m =1;
      end
      Gain_cal3: begin
         data_init = 8'h9A;
         cs_m =0 ;
         transcieve_m =1;
      end
      write_csrs7: begin
         data_init = 8'h8B;
         cs_m = 0 ;
         transcieve_m =1;
      end
      write_csrs6: begin
         data_init = 8'hB1;
         cs_m = 0 ;
         transcieve_m =1;
      end
      write_csrs5: begin
         data_init = 8'h10;
         cs_m = 0 ;
         transcieve_m =1;
      end
      write_csrs4: begin
         data_init = 8'h8B;
         cs_m = 0 ;
         transcieve_m =1;
      end
      write_csrs0: begin
         data_init = 8'h05;
         cs_m = 0 ;
         transcieve_m =1;
      end
      write_csrs1: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      write_csrs2: begin
         data_init = 8'hB0;
         cs_m = 0 ;
         transcieve_m =1;
      end
      ST_Config4: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      ST_Config3: begin
         data_init = 8'h30;
         cs_m = 0 ;
         transcieve_m =1;
      end
      ST_Config1: begin
         data_init = 8'h03;
         cs_m = 0 ;
         transcieve_m =1;
      end
      ST_Config2: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      ST_Rest_2: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      ST_Rest_4: begin
         data_init = 8'h80;
         cs_m = 0 ;
         transcieve_m =1;
      end
      ST_Rest_1: begin
         data_init = 8'h03;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait: begin
         data_init = 8'h03;
         cs_m = 0 ;
      end
      ST_Rest_RS_1: begin
         data_init = 8'h03;
         cs_m = 0 ;
         transcieve_m =1;
      end
      ST_Rest_RS_2: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      st_GPIOA9: begin
         data_init = 8'h40;
         cs_p = 0 ;
      end
      st_GPIOA10: begin
         data_init = 8'h12;
         cs_p = 0 ;
      end
      st_GPIOA11: begin
         data_init = 8'h00;
         cs_p = 0 ;
      end
      w_busy15: begin
         data_init =8'h40;
         cs_p = 0 ;
      end
      w_busy16: begin
         data_init =8'h12;
         cs_p = 0 ;
      end
      w_busy17: begin
         data_init =8'h01;
         cs_p = 0 ;
      end
      ST_IODIRA0: begin
         data_init =8'h40; 
         cs_p = 0 ;
         transcieve_p =1;
      end
      w_busy0: begin
         data_init =8'h40; 
         cs_p =0;
      end
      ST_IODIRA1: begin
         data_init =8'h00; 
         cs_p = 0 ;
         transcieve_p =1;
      end
      w_busy1: begin
         cs_p =0;
         data_init =8'h00;
      end
      ST_IODIRA2: begin
         data_init =8'h00; 
         cs_p = 0 ;
         transcieve_p =1;
      end
      w_busy2: begin
         data_init =8'h00; 
         cs_p =0;
      end
      w_busy5: begin
         data_init =8'h00; 
         cs_p =0;
      end
      st_IODIRB1: begin
         data_init =8'h01;
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_IODIRB2: begin
         data_init =8'h00; 
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_IODIRB: begin
         data_init =8'h40;
         cs_p = 0 ;
         transcieve_p =1;
      end
      w_busy3: begin
         data_init =8'h40;
         cs_p =0;
      end
      w_busy4: begin
         data_init =8'h01;
         cs_p =0;
      end
      w_busy7: begin
         data_init =8'h13;
         cs_p =0;
      end
      st_GPIOB2: begin
         data_init =8'h00;
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_GPIOB1: begin
         data_init =8'h13;
         cs_p = 0 ;
         transcieve_p =1;
      end
      w_busy8: begin
         data_init =8'h00;
         cs_p = 0 ;
      end
      w_busy6: begin
         data_init =8'h40;
         cs_p =0;
      end
      st_GPIOB0: begin
         data_init =8'h40;
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_GPPUA: begin
         data_init =8'h40;
         cs_p = 0 ;
         transcieve_p =1;
      end
      w_busy11: begin
         data_init =8'h0C;
         cs_p = 0 ;
      end
      w_busy9: begin
         cs_p = 0 ;
         data_init =8'h40;
      end
      st_GPPUA2: begin
         data_init =8'hFE;
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_GPPUA1: begin
         data_init =8'h0C;
         cs_p = 0 ;
         transcieve_p =1;
      end
      w_busy10: begin
         data_init =8'hFE;
         cs_p =0;
      end
      st_GPPUB1: begin
         data_init =8'h0D;
         cs_p = 0 ;
         transcieve_p =1;
      end
      w_busy13: begin
         data_init =8'h0D;
         cs_p = 0 ;
      end
      w_busy12: begin
         data_init =8'h40;
         cs_p = 0 ;
      end
      st_GPPUB2: begin
         data_init =8'hFF;
         cs_p = 0 ;
         transcieve_p =1;
      end
      w_busy14: begin
         data_init =8'hFF;
         cs_p = 0 ;
      end
      st_GPPUB: begin
         data_init =8'h40;
         cs_p = 0 ;
         transcieve_p =1;
      end
      CS_high0: begin
         cs_p =1;
         transcieve_p =1;
      end
      CS_high1: begin
         cs_p =1;
         transcieve_p =1;
      end
      CS_high2: begin
         cs_p =1;
         transcieve_p =1;
      end
      CS_high3: begin
         cs_p =1;
         transcieve_p =1;
      end
      CS_high4: begin
         cs_p =1;
         transcieve_p =1;
      end
      CS_high5: begin
         cs_p =1;
         transcieve_p =1;
      end
      w_busy26: begin
         cs_p = 1 ;
      end
      w_busy27: begin
         cs_p = 1 ;
      end
      w_busy28: begin
         cs_p = 1 ;
      end
      w_busy29: begin
         cs_p = 1 ;
      end
      w_busy30: begin
         cs_p = 1 ;
      end
      w_busy31: begin
         cs_p = 1 ;
      end
      CS_high7: begin
         cs_m =1;
         transcieve_m =1;
      end
      w_busy32: begin
         cs_m = 1 ;
      end
      ST_Init_0: begin
         data_init = 8'hFF;
         cs_m =0;
         transcieve_m =1;
      end
      ST_wait_0: begin
         data_init = 8'hFF;
         cs_m =0;
      end
      ST_Init_1: begin
         data_init = 8'hFF;
         cs_m =0;
         transcieve_m =1;
      end
      ST_wait_1: begin
         data_init = 8'hFF;
         cs_m =0;
      end
      ST_Init_2: begin
         data_init = 8'hFF;
         cs_m =0;
         transcieve_m =1;
      end
      ST_wait_2: begin
         data_init = 8'hFF;
         cs_m =0;
      end
      ST_Init_3: begin
         data_init = 8'hFF;
         cs_m =0;
         transcieve_m =1;
      end
      ST_wait_3: begin
         data_init = 8'hFF;
         cs_m =0;
      end
      ST_Init_4: begin
         data_init = 8'hFF;
         cs_m =0;
         transcieve_m =1;
      end
      ST_wait_4: begin
         data_init = 8'hFF;
         cs_m =0;
      end
      ST_Init_5: begin
         data_init = 8'hFF;
         cs_m =0;
         transcieve_m =1;
      end
      ST_wait_5: begin
         data_init = 8'hFF;
         cs_m =0;
      end
      ST_Init_6: begin
         data_init = 8'hFF;
         cs_m =0;
         transcieve_m =1;
      end
      ST_wait_6: begin
         data_init = 8'hFF;
         cs_m =0;
      end
      ST_Init_7: begin
         data_init = 8'hFF;
         cs_m =0;
         transcieve_m =1;
      end
      ST_wait_7: begin
         data_init = 8'hFF;
         cs_m =0;
      end
      ST_Init_8: begin
         data_init = 8'hFF;
         cs_m =0;
         transcieve_m =1;
      end
      ST_wait_8: begin
         data_init = 8'hFF;
         cs_m =0;
      end
      ST_Init_9: begin
         data_init = 8'hFF;
         cs_m =0;
         transcieve_m =1;
      end
      ST_wait_9: begin
         data_init = 8'hFF;
         cs_m =0;
      end
      ST_Init_10: begin
         data_init = 8'hFF;
         cs_m =0;
         transcieve_m =1;
      end
      ST_wait_10: begin
         data_init = 8'hFF;
         cs_m =0;
      end
      ST_Init_11: begin
         data_init = 8'hFF;
         cs_m =0;
         transcieve_m =1;
      end
      ST_wait_11: begin
         data_init = 8'hFF;
         cs_m =0;
      end
      ST_Init_12: begin
         data_init = 8'hFF;
         cs_m =0;
         transcieve_m =1;
      end
      ST_wait_12: begin
         data_init = 8'hFF;
         cs_m =0;
      end
      ST_Init_13: begin
         data_init = 8'hFF;
         cs_m =0;
         transcieve_m =1;
      end
      ST_wait_13: begin
         data_init = 8'hFF;
         cs_m =0;
      end
      ST_Init_14: begin
         data_init = 8'hFF;
         cs_m =0;
         transcieve_m =1;
      end
      ST_wait_14: begin
         data_init = 8'hFF;
         cs_m =0;
      end
      st_Init_2: begin
         data_init = 8'hFE;
         cs_m =0;
         transcieve_m =1;
      end
      ST_wait_15: begin
         data_init = 8'hFE;
         cs_m =0;
      end
      CS_high8: begin
         cs_m =1;
         transcieve_m =1;
      end
      w_busy33: begin
         cs_m = 1 ;
      end
      ST_Rest_3: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      ST_Rest_RS_3: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      ST_Rest_RS_4: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait1: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      St_wait5: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      St_wait6: begin
         data_init = 8'h80;
         cs_m = 0 ;
      end
      St_wait7: begin
         data_init = 8'h03;
         cs_m = 0 ;
      end
      St_wait8: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      St_wait9: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      St_wait10: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      CS_high9: begin
         cs_m =1;
         transcieve_m =1;
      end
      w_busy34: begin
         cs_m = 1 ;
      end
      St_wait13: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      ST_Rest_RS_6: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      ST_Rest_RS_7: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait14: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      ST_Rest_RS_8: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait15: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      St_wait16: begin
         data_init = 8'h0B;
         cs_m = 0 ;
      end
      CS_high10: begin
         cs_m =1;
         transcieve_m =1;
      end
      w_busy35: begin
         cs_m = 1 ;
      end
      CS_high12: begin
         cs_m =1;
         transcieve_m =1;
      end
      w_busy36: begin
         cs_m = 1 ;
      end
      CS_high13: begin
         cs_m =1;
         transcieve_m =1;
      end
      w_busy37: begin
         cs_m = 1 ;
      end
      w_busy38: begin
         cs_m = 1 ;
      end
      CS_high14: begin
         cs_m =1;
         transcieve_m =1;
      end
      CS_high15: begin
         cs_m =1;
         transcieve_m =1;
      end
      w_busy39: begin
         cs_m = 1 ;
      end
      St_wait17: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      St_wait18: begin
         data_init = 8'h03;
         cs_m = 0 ;
      end
      St_wait19: begin
         data_init = 8'h30;
         cs_m = 0 ;
      end
      St_wait20: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      St_wait32: begin
         data_init = 8'h81;
         cs_m = 0 ;
      end
      St_wait33: begin
         data_init = 8'h89;
         cs_m = 0 ;
      end
      St_wait34: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      ST_Config5: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      ST_Config6: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait35: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      ST_Config7: begin
         data_init = 8'h30;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait36: begin
         data_init = 8'h30;
         cs_m = 0 ;
      end
      ST_Config8: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait37: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      ST_Config9: begin
         data_init = 8'h30;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait38: begin
         data_init = 8'h30;
         cs_m = 0 ;
      end
      ST_Config10: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait39: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      St_wait40: begin
         data_init = 8'h91;
         cs_m = 0 ;
      end
      ST_Config11: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait41: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      ST_Config12: begin
         data_init = 8'h30;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait42: begin
         data_init = 8'h30;
         cs_m = 0 ;
      end
      ST_Config13: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait43: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      St_wait44: begin
         data_init = 8'h99;
         cs_m = 0 ;
      end
      ST_Config14: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait45: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      ST_Config15: begin
         data_init = 8'h30;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait46: begin
         data_init = 8'h30;
         cs_m = 0 ;
      end
      ST_Config16: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait47: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      St_wait25: begin
         data_init = 8'h05;
         cs_m = 0 ;
      end
      St_wait26: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      St_wait27: begin
         data_init = 8'hB0;
         cs_m = 0 ;
      end
      St_wait28: begin
         data_init = 8'h8B;
         cs_m = 0 ;
      end
      St_wait29: begin
         data_init = 8'h10;
         cs_m = 0 ;
      end
      St_wait30: begin
         data_init = 8'hB1;
         cs_m = 0 ;
      end
      St_wait31: begin
         data_init = 8'h8B;
         cs_m = 0 ;
      end
      ST_Read_reg2: begin
         data_init = 8'h0B;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait21: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      ST_Rest_RS_9: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      ST_Rest_RS_10: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait22: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      ST_Rest_RS_11: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait23: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      St_wait24: begin
         data_init = 8'h0B;
         cs_m = 0 ;
      end
      ST_Config17: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait48: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      ST_Config18: begin
         data_init = 8'h30;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait49: begin
         data_init = 8'h30;
         cs_m = 0 ;
      end
      St_wait50: begin
         data_init = 8'h82;
         cs_m = 0 ;
      end
      St_wait51: begin
         data_init = 8'h8A;
         cs_m = 0 ;
      end
      ST_Config19: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait52: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      ST_Config20: begin
         data_init = 8'h30;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait53: begin
         data_init = 8'h30;
         cs_m = 0 ;
      end
      St_wait54: begin
         data_init = 8'h92;
         cs_m = 0 ;
      end
      ST_Config21: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait55: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      ST_Config22: begin
         data_init = 8'h30;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait56: begin
         data_init = 8'h30;
         cs_m = 0 ;
      end
      St_wait57: begin
         data_init = 8'h9A;
         cs_m = 0 ;
      end
      ST_Config23: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait58: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      ST_Config24: begin
         data_init = 8'h30;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait59: begin
         data_init = 8'h30;
         cs_m = 0 ;
      end
      ST_CountRst: begin
         rst_mon_cnt =1;
      end
      ST_Start_Cnt: begin
         start_mon_cnt = 1;
      end
      ST_Read_reg3: begin
         data_init = 8'h0B;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait60: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      ST_Rest_RS_12: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      ST_Rest_RS_13: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait61: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      ST_Rest_RS_14: begin
         data_init = 8'h00;
         cs_m = 0 ;
         transcieve_m =1;
      end
      St_wait62: begin
         data_init = 8'h00;
         cs_m = 0 ;
      end
      St_wait63: begin
         data_init = 8'h0B;
         cs_m = 0 ;
      end
      CS_high16: begin
         cs_p =1;
         transcieve_p =1;
      end
      w_busy43: begin
         cs_p = 1 ;
      end
      st_GPIOA15: begin
         data_init =8'h40;
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_GPIOA16: begin
         data_init =8'h09;
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_GPIOA17: begin
         data_init =8'h01;
         cs_p = 0 ;
         transcieve_p =1;
      end
      w_busy40: begin
         data_init =8'h40;
         cs_p = 0 ;
      end
      w_busy41: begin
         data_init =8'h09;
         cs_p = 0 ;
      end
      w_busy42: begin
         data_init =8'h01;
         cs_p = 0 ;
      end
      CS_high6: begin
         cs_p =1;
         transcieve_p =1;
      end
      w_busy44: begin
         cs_p = 1 ;
      end
      CS_high17: begin
         cs_p =1;
         transcieve_p =1;
      end
      w_busy48: begin
         cs_p = 1 ;
      end
      st_GPIOA12: begin
         data_init =8'h40;
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_GPIOA13: begin
         data_init =8'h12;
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_GPIOA14: begin
         data_init =8'h01;
         cs_p = 0 ;
         transcieve_p =1;
      end
      w_busy18: begin
         data_init =8'h40;
         cs_p = 0 ;
      end
      w_busy19: begin
         data_init =8'h12;
         cs_p = 0 ;
      end
      w_busy20: begin
         data_init =8'h01;
         cs_p = 0 ;
      end
      st_GPIOA18: begin
         data_init =8'h40;
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_GPIOA19: begin
         data_init =8'h09;
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_GPIOA20: begin
         data_init =8'h01;
         cs_p = 0 ;
         transcieve_p =1;
      end
      w_busy45: begin
         data_init =8'h40;
         cs_p = 0 ;
      end
      w_busy46: begin
         data_init =8'h09;
         cs_p = 0 ;
      end
      w_busy47: begin
         data_init =8'h01;
         cs_p = 0 ;
      end
      CS_high11: begin
         cs_p =1;
         transcieve_p =1;
      end
      w_busy49: begin
         cs_p = 1 ;
      end
      CS_high18: begin
         cs_p =1;
         transcieve_p =1;
      end
      w_busy53: begin
         cs_p = 1 ;
      end
      st_GPIOA21: begin
         data_init =8'h40;
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_GPIOA22: begin
         data_init =8'h12;
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_GPIOA23: begin
         data_init =8'h00;
         cs_p = 0 ;
         transcieve_p =1;
      end
      w_busy21: begin
         data_init =8'h40;
         cs_p = 0 ;
      end
      w_busy22: begin
         data_init =8'h12;
         cs_p = 0 ;
      end
      w_busy23: begin
         data_init =8'h00;
         cs_p = 0 ;
      end
      st_GPIOA24: begin
         data_init =8'h40;
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_GPIOA25: begin
         data_init =8'h09;
         cs_p = 0 ;
         transcieve_p =1;
      end
      st_GPIOA26: begin
         data_init =8'h00;
         cs_p = 0 ;
         transcieve_p =1;
      end
      w_busy50: begin
         data_init =8'h40;
         cs_p = 0 ;
      end
      w_busy51: begin
         data_init =8'h09;
         cs_p = 0 ;
      end
      w_busy52: begin
         data_init =8'h00;
         cs_p = 0 ;
      end
      s0: begin
         start_read_elink =1;
      end
      s1: begin
         start_read_elink =1;
      end
   endcase
end // Output Block

//-----------------------------------------------------------------
// Clocked Block for machine csm
//-----------------------------------------------------------------
always @(
   posedge clk
) 
begin : clocked_block_proc
   if (!rst) begin
      current_state <= reset;
      csm_timer <= 6'd0;
   end
   else if (timeoutrst) begin
      current_state <= reset;
      csm_timer <= 6'd0;
   end
   else if (abort) begin
      current_state <= reset;
      csm_timer <= 6'd0;
   end
   else begin
      current_state <= next_state;
      csm_timer <= csm_next_timer;
   end
end // Clocked Block

//-----------------------------------------------------------------
// Wait state logic for machine csm
//-----------------------------------------------------------------
always @(
   csm_timer,
   csm_to_CS_low,
   csm_to_Read_Miso
)
begin : csm_wait_block_proc
   csm_timeout = (csm_timer == 6'd0);
   if (csm_to_CS_low == 1'b1) begin
      csm_next_timer = 6'd9;  //no cycles(10)-1=9
   end
   else if (csm_to_Read_Miso == 1'b1) begin
      csm_next_timer = 6'd39;  //no cycles(40)-1=39
   end
   else begin
      csm_next_timer = (csm_timeout)? 6'd0: (csm_timer - 6'd1);
   end
end // Wait State Block
// State-As-Output assignment
always @(current_state)
statedeb = current_state;

endmodule // bus_control_SM

//
// Module mopshub_lib.EPROC_IN_DEC8b10b.struct
//
// Created:
//          by - dcs.dcs (chipdev2.physik.uni-wuppertal.de)
//          at - 13:01:43 04/08/21
//
// Generated by Mentor Graphics' HDL Designer(TM) 2018.1 (Build 12)
//

`resetall
`timescale 1ns/10ps
module EPROC_IN_DEC8b10b( 
   // Port Declarations
   input   wire    [1:0]  DATA_IN, 
   input   wire           bitCLK, 
   input   wire           bitCLKx4, 
   input   wire           rst, 
   input   wire           swap_inputbits, 
   input   wire           thCR_REVERSE_10B, 
   output  reg     [9:0]  DATA_OUT_dbg       = 10'b0, 
   output  wire           DATA_RDY, 
   output  wire    [7:0]  HGFEDCBA, 
   output  wire    [1:0]  ISK
);


// Internal Declarations


// Local declarations

// Internal signal declarations
wire         BUSY;
reg          align_select          = 0;
reg   [4:0]  alignment_sreg        = 5'b0;
// Port Declarations
wire  [9:0]  bitstream_align0;                //2 words of 10bit
wire  [9:0]  bitstream_align1;
wire  [11:0] bitstream_in;
wire         code_err;
wire  [1:0]  comma_valid_bits;
wire         comma_valid_bits_or;
wire         disp_err;
reg   [9:0]  word10b               = 10'b0;


// Instances 
bitstream_deserializer U_0( 
   .DATA_IN        (DATA_IN), 
   .bitCLK         (bitCLK), 
   .rst            (rst), 
   .swap_inputbits (swap_inputbits), 
   .dout           (bitstream_in)
); 

dec_8b10b_wrap #(0) U_2( 
   .ABCDEIFGHJ_IN (word10b), 
   .RBYTECLK      (bitCLKx4), 
   .datain_valid  (DATA_RDY), 
   .reset         (rst), 
   .BUSY          (BUSY), 
   .HGFEDCBA      (HGFEDCBA), 
   .ISK           (ISK), 
   .code_err      (code_err), 
   .disp_err      (disp_err)
); 

sync_detector #(0) U_1( 
   .bitstream_align0 (bitstream_align0), 
   .comma_valid_bits (comma_valid_bits), 
   .bitstream_in     (bitstream_in), 
   .bitCLK           (bitCLK), 
   .thCR_REVERSE_10B (thCR_REVERSE_10B), 
   .rst              (rst), 
   .bitstream_align1 (bitstream_align1)
); 

// HDL Embedded Text Block 3 alignment_rdy
// eb1 1                                        
assign DATA_RDY  = alignment_sreg[4]; 












// HDL Embedded Text Block 7 align_select
// eb1 1                                        
always@(posedge bitCLK)
if (rst)
  begin
    align_select <=0;
    alignment_sreg <=5'b0; //alignment selector state
  end
else 
begin
  if(comma_valid_bits_or ==1) 
  begin
    align_select <= (!comma_valid_bits[0]) & comma_valid_bits[1];
    alignment_sreg <= 5'b10000; 
  end 
  else
   alignment_sreg <= {alignment_sreg[0],alignment_sreg[4:1]};  
end














// HDL Embedded Text Block 8 alignment_word10b
// Prepare_8b10b_data                                     
//-------------------------------------------------------------------------------------------
//--clock2
//-- alignment selected
//-------------------------------------------------------------------------------------------

always@(posedge bitCLK)
if (rst)
  begin
    word10b <=10'b0;
    DATA_OUT_dbg <=10'b0;
  end
else
    case (align_select)
        1'b0 :begin //when bit0 word got comma => align to bitstream_align_array0
          word10b <= bitstream_align0;
          DATA_OUT_dbg <=bitstream_align0;
          end
        1'b1 :begin //when bit1 word got comma => align to bitstream_align_array1
          word10b <= bitstream_align1;
          DATA_OUT_dbg <=bitstream_align1;
          end     
    endcase





















// HDL Embedded Text Block 10 eb3

assign comma_valid_bits_or =  (comma_valid_bits[1] | comma_valid_bits[0]);
 






endmodule // EPROC_IN_DEC8b10b


//
// Module mopshub_testbench.data_generator.struct
//
// Created:
//          by - dcs.dcs (chipdev2.physik.uni-wuppertal.de)
//          at - 09:10:14 02/22/22
//
// Generated by Mentor Graphics' HDL Designer(TM) 2019.4 (Build 4)
//

`resetall
`timescale 1ns/10ps
module data_generator #(
   // synopsys template
   parameter SDO_TX               = 5'h0C,
   parameter n_buses              = 5'b11111,
   parameter seialize_data_stream = 1'b1
)
( 
   // Port Declarations
   input   wire            rst, 
   input   wire            clk,                    // write FIFO clk
   output  wire            buffer_en, 
   input   wire            loop_en, 
   input   wire            start_read_elink, 
   input   wire            osc_auto_trim, 
   output  wire            reqmsg, 
   output  wire            respmsg, 
   output  wire    [31:0]  adc_ch, 
   output  wire            rx0, 
   output  wire            end_read_elink, 
   output  wire            trim_sig_start, 
   output  wire            test_rx_start, 
   output  wire    [75:0]  bus_dec_data, 
   output  wire            rx1, 
   input   wire            tx0, 
   input   wire            tx1, 
   output  wire    [7:0]   bus_id, 
   input   wire            start_data_gen, 
   input   wire            sel_bus, 
   input   wire    [4:0]   bus_cnt, 
   output  wire    [1:0]   tx_elink2bit, 
   input   wire    [1:0]   rx_elink2bit, 
   input   wire            rx_elink1bit, 
   output  wire            tx_elink1bit, 
   output  wire            start_write_emulator, 
   input   wire            test_rx, 
   input   wire            test_tx, 
   output  wire            test_tx_end, 
   output  wire            test_rx_end, 
   output  wire            test_tx_start, 
   input   wire            test_mopshub_core, 
   output  wire            test_elink_data_done, 
   output  wire            rx2, 
   output  wire            rx3, 
   input   wire            tx2, 
   input   wire            tx3, 
   output  wire            rx4, 
   output  wire            rx5, 
   input   wire            tx4, 
   input   wire            tx5, 
   output  wire            rx6, 
   output  wire            trim_sig_end, 
   output  wire            rx7, 
   input   wire            tx6, 
   input   wire            ext_rst_mops, 
   input   wire            ext_trim_mops, 
   input   wire            tx7, 
   output  wire            trim_sig_done, 
   input   wire            clk_80, 
   output  wire            irq_elink_tra, 
   input   wire    [75:0]  data_rec_uplink, 
   input   wire    [75:0]  data_tra_downlink, 
   input   wire            start_init, 
   input   wire            end_init, 
   input   wire    [4:0]   can_tra_select, 
   input   wire            end_trim_bus, 
   input   wire            osc_auto_trim_mopshub, 
   input   wire    [4:0]   power_bus_cnt, 
   input   wire            start_trim_osc, 
   input   wire    [4:0]   can_rec_select, 
   input   wire            test_advanced, 
   output  wire            costum_msg_end, 
   output  wire            costum_msg_start, 
   output  wire            rx10, 
   output  wire            rx11, 
   output  wire            rx12, 
   output  wire            rx13, 
   output  wire            rx14, 
   output  wire            rx15, 
   output  wire            rx8, 
   output  wire            rx9, 
   input   wire            tx10, 
   input   wire            tx11, 
   input   wire            tx12, 
   input   wire            tx13, 
   input   wire            tx14, 
   input   wire            tx15, 
   input   wire            tx8, 
   input   wire            tx9, 
   output  wire            rx16, 
   output  wire            rx17, 
   output  wire            rx18, 
   output  wire            rx19, 
   output  wire            rx20, 
   output  wire            rx21, 
   output  wire            rx22, 
   output  wire            rx23, 
   input   wire            tx16, 
   input   wire            tx17, 
   input   wire            tx18, 
   input   wire            tx19, 
   input   wire            tx20, 
   input   wire            tx21, 
   input   wire            tx22, 
   input   wire            tx23, 
   output  wire            rx24, 
   output  wire            rx25, 
   output  wire            rx26, 
   output  wire            rx27, 
   output  wire            rx28, 
   output  wire            rx29, 
   output  wire            rx30, 
   output  wire            rx31, 
   input   wire            tx24, 
   input   wire            tx25, 
   input   wire            tx26, 
   input   wire            tx27, 
   input   wire            tx28, 
   input   wire            tx29, 
   input   wire            tx30, 
   input   wire            tx31, 
   input   wire            ext_counter_gen, 
   input   wire            rx_din, 
   output  wire            tx_dout
);


// Internal Declarations


// Local declarations

// Internal signal declarations
reg          rst_mops                  = 0;
wire  [75:0] emulator_rec_in;
reg   [75:0] data_rec_in               = 76'b0;
wire         start_read_emulator       = 1'b1;
wire  [4:0]  bus_loop_cnt;
wire  [11:0] sdoid;                                  // this is the actual ID of the CANOpen message for SDO objects
wire         counter_gen_en;
wire         counter_en;
wire  [2:0]  state_o;
reg          cnt_done;
wire         clk_low;
wire         start;                                 // To start Driver /generator
wire         read;                                  // Prepare SDO read request
wire         write;                                 // Prepare SDO write request
wire  [23:0] indexsubindex;                          // from state machine index and subindex to write and read. Index bytes are sent LSB first 
wire  [31:0] taildata;                              // Data which must be written to the chip 
wire  [63:0] data;                                  // Complete 8 bytes of data to be sent in a custom message
wire         readadc;                               // indicates to read an ADC channel 
wire  [10:0] customcanid;                           // ID to be sent in a custom message
wire         custommsg;                             // To start a custom message
wire         txgen;
wire  [3:0]  dlc                       = 4'h8;      // "1" = wait for oscillator trimming before sign-in message 
wire  [10:0] id                        = 11'h601;   // here define the node id for the chip to communicate with 
reg   [6:0]  can_nodeid                = 7'h1;       // Hardwired CANopen Node-ID for each DCS controller chip
wire         ready_osc;
wire         txdec_active;
wire         txdec;
reg   [31:0] payload                   = 32'b0;
wire         rxdec;
wire  [4:0]  select_bus;
wire         rst_cnt;
wire         tx_mopshub;
wire         rx_mopshub;
wire         end_write_emulator;
wire  [75:0] data_rec_76bit_reg;
wire  [75:0] data_tra_76bit_reg;
wire         rst_mops_dbg;
wire         enc_stream                = 1;
wire         const_val;
wire  [75:0] rand_rec_in;
wire         tx_emulator;
wire  [31:0] emulator_spi_in;
wire         start_write_emulator_spi;
wire         end_write_emulator_spi;


// Instances 
bit_counter bit_counter0( 
   .ext_rst    (rst_cnt), 
   .rst        (rst), 
   .data_out   (bus_loop_cnt), 
   .clk        (clk), 
   .cnt_enable (counter_en)
); 

CANbus_decoder CANbus_decoder0( 
   .clk          (clk), 
   .rst          (rst), 
   .rx           (rxdec), 
   .data_rec_out (bus_dec_data), 
   .tx           (txdec)
); 

can_bus_activity can_bus_activity0( 
   .clk                   (clk), 
   .rst                   (rst), 
   .bus_id                (bus_id), 
   .can_tra_select        (can_tra_select), 
   .can_rec_select        (can_rec_select), 
   .power_bus_cnt         (power_bus_cnt), 
   .start_init            (start_init), 
   .end_init              (end_init), 
   .trim_sig_start        (trim_sig_start), 
   .trim_sig_end          (trim_sig_end), 
   .test_tx               (test_tx), 
   .test_tx_start         (test_tx_start), 
   .test_tx_end           (test_tx_end), 
   .test_rx               (test_rx), 
   .test_rx_start         (test_rx_start), 
   .test_rx_end           (test_rx_end), 
   .test_mopshub_core     (test_mopshub_core), 
   .test_advanced         (test_advanced), 
   .costum_msg_start      (costum_msg_start), 
   .costum_msg_end        (costum_msg_end), 
   .osc_auto_trim         (osc_auto_trim), 
   .osc_auto_trim_mopshub (osc_auto_trim_mopshub), 
   .end_trim_bus          (end_trim_bus), 
   .start_trim_osc        (start_trim_osc), 
   .data_rec_uplink       (data_rec_uplink), 
   .data_tra_downlink     (data_tra_downlink), 
   .bus_dec_data          (bus_dec_data), 
   .reqmsg                (reqmsg), 
   .respmsg               (respmsg)
); 

can_net_decoder can_net_decoder_Gen( 
   .bus_cnt       (bus_cnt), 
   .bus_loop_cnt  (bus_loop_cnt), 
   .clk           (clk), 
   .ext_rst_mops  (ext_rst_mops), 
   .ext_trim_mops (ext_trim_mops), 
   .osc_auto_trim (osc_auto_trim), 
   .power_bus_cnt (power_bus_cnt), 
   .rst           (rst), 
   .rst_mops      (rst_mops), 
   .sel_bus       (sel_bus), 
   .test_advanced (test_advanced), 
   .tx_mopshub0   (tx0), 
   .tx_mopshub1   (tx1), 
   .tx_mopshub10  (tx10), 
   .tx_mopshub11  (tx11), 
   .tx_mopshub12  (tx12), 
   .tx_mopshub13  (tx13), 
   .tx_mopshub14  (tx14), 
   .tx_mopshub15  (tx15), 
   .tx_mopshub16  (tx16), 
   .tx_mopshub17  (tx17), 
   .tx_mopshub18  (tx18), 
   .tx_mopshub19  (tx19), 
   .tx_mopshub2   (tx2), 
   .tx_mopshub20  (tx20), 
   .tx_mopshub21  (tx21), 
   .tx_mopshub22  (tx22), 
   .tx_mopshub23  (tx23), 
   .tx_mopshub24  (tx24), 
   .tx_mopshub25  (tx25), 
   .tx_mopshub26  (tx26), 
   .tx_mopshub27  (tx27), 
   .tx_mopshub28  (tx28), 
   .tx_mopshub29  (tx29), 
   .tx_mopshub3   (tx3), 
   .tx_mopshub30  (tx30), 
   .tx_mopshub31  (tx31), 
   .tx_mopshub4   (tx4), 
   .tx_mopshub5   (tx5), 
   .tx_mopshub6   (tx6), 
   .tx_mopshub7   (tx7), 
   .tx_mopshub8   (tx8), 
   .tx_mopshub9   (tx9), 
   .txdec         (txdec), 
   .txgen         (txgen), 
   .ready_osc     (ready_osc), 
   .rx_mopshub    (rx_mopshub), 
   .rx_mopshub0   (rx0), 
   .rx_mopshub1   (rx1), 
   .rx_mopshub10  (rx10), 
   .rx_mopshub11  (rx11), 
   .rx_mopshub12  (rx12), 
   .rx_mopshub13  (rx13), 
   .rx_mopshub14  (rx14), 
   .rx_mopshub15  (rx15), 
   .rx_mopshub16  (rx16), 
   .rx_mopshub17  (rx17), 
   .rx_mopshub18  (rx18), 
   .rx_mopshub19  (rx19), 
   .rx_mopshub2   (rx2), 
   .rx_mopshub20  (rx20), 
   .rx_mopshub21  (rx21), 
   .rx_mopshub22  (rx22), 
   .rx_mopshub23  (rx23), 
   .rx_mopshub24  (rx24), 
   .rx_mopshub25  (rx25), 
   .rx_mopshub26  (rx26), 
   .rx_mopshub27  (rx27), 
   .rx_mopshub28  (rx28), 
   .rx_mopshub29  (rx29), 
   .rx_mopshub3   (rx3), 
   .rx_mopshub30  (rx30), 
   .rx_mopshub31  (rx31), 
   .rx_mopshub4   (rx4), 
   .rx_mopshub5   (rx5), 
   .rx_mopshub6   (rx6), 
   .rx_mopshub7   (rx7), 
   .rx_mopshub8   (rx8), 
   .rx_mopshub9   (rx9), 
   .rxdec         (rxdec), 
   .select_bus    (select_bus), 
   .tx_mopshub    (tx_mopshub)
); 

canframegen canframegen_gen( 
   .clk           (clk), 
   .clk_low       (clk_low), 
   .rst_n         (rst), 
   .start         (start), 
   .read          (read), 
   .write         (write), 
   .random1000    (const_val), 
   .indexsubindex (indexsubindex), 
   .rstchip       (const_val), 
   .readadc       (readadc), 
   .allch         (const_val), 
   .ch            (adc_ch), 
   .custommsg     (custommsg), 
   .dlc           (dlc), 
   .data          (data), 
   .id            (id), 
   .txgen         (txgen), 
   .doneranwire   (), 
   .finranmes     (), 
   .sendran       (const_val), 
   .nextran       (const_val), 
   .taildata      (taildata), 
   .customcanid   (customcanid)
); 

clk_div clk_div_gen( 
   .clk     (clk), 
   .clk_low (clk_low), 
   .rst     (rst)
); 

data_generator_SM data_generator_SM0( 
   .clk                      (clk), 
   .rst                      (rst), 
   .irq_elink_tra            (irq_elink_tra), 
   .state_o                  (state_o), 
   .loop_en                  (loop_en), 
   .start_read_elink         (start_read_elink), 
   .end_read_elink           (end_read_elink), 
   .txdec                    (txdec_active), 
   .cnt_done                 (cnt_done), 
   .counter_gen_en           (counter_gen_en), 
   .buffer_en                (buffer_en), 
   .ch                       (adc_ch), 
   .custommsg                (custommsg), 
   .data                     (data), 
   .start                    (start), 
   .reqmsg                   (reqmsg), 
   .respmsg                  (respmsg), 
   .indexsubindex            (indexsubindex), 
   .read                     (read), 
   .taildata                 (taildata), 
   .write                    (write), 
   .readadc                  (readadc), 
   .customcanid              (customcanid), 
   .osc_auto_trim            (osc_auto_trim), 
   .test_rx                  (test_rx), 
   .test_rx_start            (test_rx_start), 
   .test_rx_end              (test_rx_end), 
   .trim_sig_start           (trim_sig_start), 
   .trim_response_done       (ready_osc), 
   .trim_sig_end             (trim_sig_end), 
   .start_data_gen           (start_data_gen), 
   .test_mopshub_core        (test_mopshub_core), 
   .sel_bus                  (sel_bus), 
   .test_elink_data_done     (test_elink_data_done), 
   .rst_cnt                  (rst_cnt), 
   .rxdec                    (rxdec), 
   .start_write_emulator     (start_write_emulator), 
   .test_tx                  (test_tx), 
   .end_write_emulator       (end_write_emulator), 
   .test_tx_end              (test_tx_end), 
   .test_tx_start            (test_tx_start), 
   .rst_mops_dbg             (rst_mops_dbg), 
   .trim_sig_done            (trim_sig_done), 
   .costum_msg_start         (costum_msg_start), 
   .costum_msg_end           (costum_msg_end), 
   .tx_mopshub               (tx_mopshub), 
   .rx_mopshub               (rx_mopshub), 
   .test_advanced            (test_advanced), 
   .rand_rec_in              (rand_rec_in), 
   .start_write_emulator_spi (start_write_emulator_spi), 
   .end_write_emulator_spi   (end_write_emulator_spi)
); 

mopshub_decoder #(seialize_data_stream) mopshub_decoder_emulator( 
   .clk                   (clk), 
   .rx_elink2bit          (rx_elink2bit), 
   .clk_80                (clk_80), 
   .rst                   (rst), 
   .data_tra_out          (), 
   .data_tra_76bit_reg    (data_tra_76bit_reg), 
   .tx_elink2bit          (tx_elink2bit), 
   .data_rec_76bit_reg    (data_rec_76bit_reg), 
   .start_write_elink     (start_write_emulator), 
   .end_write_elink       (end_write_emulator), 
   .data_rec_in           (emulator_rec_in), 
   .tx_emulator           (tx_emulator), 
   .tx_elink1bit          (tx_elink1bit), 
   .rx_elink1bit          (rx_elink1bit), 
   .rx_din                (rx_din), 
   .enc_stream            (enc_stream), 
   .tx_dout               (tx_dout), 
   .start_read_elink      (start_read_emulator), 
   .data_rec_spi_in       (emulator_spi_in), 
   .start_write_elink_spi (start_write_emulator_spi), 
   .end_write_elink_spi   (end_write_emulator_spi)
); 

// HDL Embedded Text Block 1 data_loader
// data_loader 1
assign sdoid  = {SDO_TX,can_nodeid}; 
assign bus_id = {3'h0,select_bus};
always @(posedge clk)
begin
  if(!rst) data_rec_in <= {sdoid,32'h0, bus_id};
  else
  case (select_bus)
    5'h0  : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h1  : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h2  : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h3  : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h4  : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h5  : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h6  : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h7  : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h8  : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h9  : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'hA  : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'hB  : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'hC  : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'hD  : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'hE  : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'hF  : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h10 : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h11 : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h12 : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h13 : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h14 : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h15 : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h16 : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h17 : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h18 : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h19 : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h1A : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h1B : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h1C : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h1D : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h1E : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    5'h1F : data_rec_in  <= {sdoid,payload,bus_id, 8'h0,16'h0};
    default: data_rec_in  <=  {sdoid,56'h0, bus_id, 8'h0,16'h0};    
  endcase 
end                                            









































































































// HDL Embedded Text Block 2 trigger_signal
always @(posedge clk)
  begin
    if (!rst)
    begin
    cnt_done <= 0;
    end
    else 
    begin
      case(bus_loop_cnt)
       n_buses:begin
          cnt_done <= 1;
        end
      default:begin
          cnt_done <= 0;
        end
      endcase
  end
end

















// HDL Embedded Text Block 4 ch_def
always @(posedge clk)
begin
  if(!rst)
  payload <= {16'h0, 16'h0};
  else
  case (adc_ch)
    5'h0  : payload  <= {16'h4010, 16'h2301};
    5'h1  : payload  <= {16'h4010, 16'h2302};
    5'h2  : payload  <= {16'h4010, 16'h2303};
    5'h3  : payload  <= {16'h4000, 16'h2401};
    5'h4  : payload  <= {16'h4000, 16'h2402};
    5'h5  : payload  <= {16'h4000, 16'h2403};    
    5'h6  : payload  <= {16'h4000, 16'h2404};  
    5'h7  : payload  <= {16'h4000, 16'h2405};
    5'h8  : payload  <= {16'h4000, 16'h2406};
    5'h9  : payload  <= {16'h4000, 16'h2407};
    5'hA  : payload  <= {16'h4000, 16'h2408};
    5'hB  : payload  <= {16'h4000, 16'h2409};
    5'hC  : payload  <= {16'h4000, 16'h240A};
    5'hD  : payload  <= {16'h4000, 16'h240B};
    5'hE  : payload  <= {16'h4000, 16'h240C};
    5'hF  : payload  <= {16'h4000, 16'h240D};
    5'h10 : payload  <= {16'h4000, 16'h240E};
    5'h11 : payload  <= {16'h4000, 16'h240F};
    5'h12 : payload  <= {16'h4000, 16'h24010};
    5'h13 : payload  <= {16'h4000, 16'h24011};
    5'h14 : payload  <= {16'h4000, 16'h24012};
    5'h15 : payload  <= {16'h4000, 16'h24013};
    5'h16 : payload  <= {16'h4000, 16'h24014};
    5'h17 : payload  <= {16'h4000, 16'h24015};
    5'h18 : payload  <= {16'h4000, 16'h24016};
    5'h19 : payload  <= {16'h4000, 16'h24017};
    5'h1A : payload  <= {16'h4000, 16'h24018};
    5'h1B : payload  <= {16'h4000, 16'h24019};
    5'h1C : payload  <= {16'h4000, 16'h2401A};
    5'h1D : payload  <= {16'h4000, 16'h2401B};
    5'h1E : payload  <= {16'h4000, 16'h2401C};
    5'h1F : payload  <= {16'h4000, 16'h2401D};
    5'h20 : payload  <= {16'h4000, 16'h2401E};
    5'h21 : payload  <= {16'h4000, 16'h2401F};
    5'h22 : payload  <= {16'h4000, 16'h24020};
    5'h23 : payload  <= {16'h4000, 16'h24021};
    5'h24 : payload  <= {16'h4000, 16'h24022};
    5'h25 : payload  <= {16'h4000, 16'h24023};
    5'h26 : payload  <= {16'h4000, 16'h24024};
    5'h27 : payload  <= {16'h4000, 16'h24025};        
    default: 
    begin 
      payload  <= {16'h0, 16'h0};
    end    
  endcase
end                                            




























































































// HDL Embedded Text Block 5 rst_mops
assign counter_en = (ext_counter_gen ||counter_gen_en);
always@(posedge clk)
if (!rst)
rst_mops <=0;
else 
begin
if (rst_mops_dbg ==1 ||ext_rst_mops==1)
rst_mops <=0;
else
rst_mops <=1; 
end


























// HDL Embedded Text Block 6 channel_def
//control Signals
assign emulator_rec_in  =(test_advanced ==1'b1) ? rand_rec_in : data_rec_in;
assign emulator_spi_in  = rand_rec_in[75:44];

assign  txdec_active = ^(txdec &tx_emulator);




// ModuleWare code(v1.12) for instance 'const' of 'constval'
assign const_val = 1'd0;

endmodule // data_generator


/****************************************************************************************************
 *                          ! THIS FILE WAS AUTO-GENERATED BY TMRG TOOL !                           *
 *                                   ! DO NOT EDIT IT MANUALLY !                                    *
 *                                                                                                  *
 * file    : ./output/enc8b10b_wrap_structTMR.v                                                     *
 *                                                                                                  *
 * user    : lucas                                                                                  *
 * host    : DESKTOP-BFDSFP2                                                                        *
 * date    : 06/10/2022 13:52:47                                                                    *
 *                                                                                                  *
 * workdir : /mnt/c/Users/Lucas/Documents/GitHub/mopshub_triplicated/triplicated/mopshub_top_board/hdl *
 * cmd     : /mnt/c/Users/Lucas/Desktop/mopshub_triplication/tmrg-master/bin/tmrg -vv -c tmrg.cfg   *
 * tmrg rev:                                                                                        *
 *                                                                                                  *
 * src file: enc8b10b_wrap_struct.v                                                                 *
 *           Git SHA           : c110441b08b692cc54ebd4a3b84a2599430e8f93                           *
 *           Modification time : 2022-10-06 13:25:17                                                *
 *           File Size         : 2686                                                               *
 *           MD5 hash          : 38ab8ff489e5635fef82491097eefc03                                   *
 *                                                                                                  *
 ****************************************************************************************************/

module enc8b10b_wrapTMR(
  input wire  clk ,
  input wire  rst ,
  input wire [1:0] data_code ,
  input wire [7:0] data_in ,
  input wire  data_in_rdy ,
  output wire [9:0] enc_10b_data_out ,
  input wire [7:0] Kchar_comma ,
  input wire [7:0] Kchar_eop ,
  input wire [7:0] Kchar_sop ,
  input wire [9:0] COMMAp ,
  input wire [9:0] COMMAn 
);
reg  [9:0] enc_10b_data_out_r ;
wire [7:0] byte;
reg  KI_reg ;
wire [9:0] data_out;
reg  bit_cnt ;

enc_8b10b_mopshubTMR enc_8b10b_mopshub0 (
    .rst(rst),
    .clk(clk),
    .ena(data_in_rdy),
    .ki(KI_reg),
    .datain(byte),
    .dataout(data_out)
    );

mux4_NbitTMR mux4_Nbit0 (
    .rst(rst),
    .data0(data_in),
    .data1(Kchar_eop),
    .data2(Kchar_sop),
    .data3(Kchar_comma),
    .sel(data_code),
    .data_out(byte),
    .def_value(Kchar_comma)
    );
initial
  KI_reg =  1'b1;

always @( posedge clk )
  if (!rst)
    KI_reg <= 1'b1;
  else
    KI_reg <= data_code[1] |data_code[0] ;
initial
  begin
    bit_cnt =  1'b0;
  end

always @( posedge clk )
  if (!rst)
    bit_cnt <= 1'b0;
  else
    bit_cnt <= !bit_cnt;
assign enc_10b_data_out =  enc_10b_data_out_r;

always @( posedge clk )
  if (!rst)
    enc_10b_data_out_r <= COMMAp;
  else
    begin
      if (data_in==Kchar_comma&&KI_reg==1)
        begin
          if (bit_cnt==1)
            enc_10b_data_out_r <= COMMAp;
          else
            enc_10b_data_out_r <= COMMAn;
        end
      else
        enc_10b_data_out_r <= data_out;
    end
endmodule

